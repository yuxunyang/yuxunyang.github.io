<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>折腾自建博客系列 - 遇寻笔记</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="遇寻笔记"><meta name="msapplication-TileImage" content="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="遇寻笔记"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="今年年初由 wordpress 迁移到 halo，主要是觉得懂点 Java，有什么定制化的需求，自己改代码会方便一些。但是也没有什么特别的需求需要定制，反而被这种东西折腾得忘记了写博客的初心。技术博客就应该简简单单，只写技术，博客怎么好看、怎么炫酷，都不重要。配置说明&amp;amp;前置条件在 Halo"><meta property="og:type" content="article"><meta property="og:title" content="折腾自建博客系列"><meta property="og:url" content="https://eucham.me/2020/09/05/795d32ee2085.html"><meta property="og:site_name" content="遇寻笔记"><meta property="og:description" content="今年年初由 wordpress 迁移到 halo，主要是觉得懂点 Java，有什么定制化的需求，自己改代码会方便一些。但是也没有什么特别的需求需要定制，反而被这种东西折腾得忘记了写博客的初心。技术博客就应该简简单单，只写技术，博客怎么好看、怎么炫酷，都不重要。配置说明&amp;amp;前置条件在 Halo"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://eucham.me/images/pics/6b91bb410de72df7d680045ea7684ebf.png"><meta property="article:published_time" content="2020-09-05T07:27:30.000Z"><meta property="article:modified_time" content="2021-12-31T07:31:15.596Z"><meta property="article:author" content="遇寻"><meta property="article:tag" content="hexo"><meta property="article:tag" content=" icarus"><meta property="article:tag" content="halo"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/pics/6b91bb410de72df7d680045ea7684ebf.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://eucham.me/2020/09/05/795d32ee2085.html"},"headline":"折腾自建博客系列","image":["https://eucham.me/images/pics/6b91bb410de72df7d680045ea7684ebf.png"],"datePublished":"2020-09-05T07:27:30.000Z","dateModified":"2021-12-31T07:31:15.596Z","author":{"@type":"Person","name":"遇寻"},"publisher":{"@type":"Organization","name":"遇寻笔记","logo":{"@type":"ImageObject","url":"https://eucham.me/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"}},"description":"今年年初由 wordpress 迁移到 halo，主要是觉得懂点 Java，有什么定制化的需求，自己改代码会方便一些。但是也没有什么特别的需求需要定制，反而被这种东西折腾得忘记了写博客的初心。技术博客就应该简简单单，只写技术，博客怎么好看、怎么炫酷，都不重要。配置说明&amp;前置条件在 Halo"}</script><link rel="canonical" href="https://eucham.me/2020/09/05/795d32ee2085.html"><link rel="icon" href="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?7d79380bb26079f6dd33da78e83cf2ab";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="遇寻笔记" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/categories/AI">AI</a><a class="navbar-item" href="/categories/Kubernetes">Kubernetes</a><a class="navbar-item" href="/categories/Openstack">Openstack</a><a class="navbar-item" href="/categories/Docker">Container</a><a class="navbar-item" href="/categories/Golang">Golang</a><a class="navbar-item" href="/categories/Rust">Rust</a><a class="navbar-item" href="/about.html">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/eucham"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/eucham"><i class="fab fa-linkedin"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-05T07:27:30.000Z" title="9/5/2020, 3:27:30 PM">2020-09-05</time>发表</span><span class="level-item"><time dateTime="2021-12-31T07:31:15.596Z" title="12/31/2021, 3:31:15 PM">2021-12-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></span><span class="level-item">35 分钟读完 (大约5186个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">折腾自建博客系列</h1><div class="content"><h2 id="从CSDN迁移到Github-Pages"><a href="#从CSDN迁移到Github-Pages" class="headerlink" title="从CSDN迁移到Github Pages"></a>从CSDN迁移到Github Pages</h2><blockquote>
<p>打算将CSDN上的博客迁移到GitHub Pages上去，怕有一天所有的博客都不见了的时候，自己会有一个备份. 其中，上传到CSDN网站上的图片，是必须要自己有一个备份的。所以，便有了这一篇记录博客。</p>
</blockquote>
<h3 id="了解Scrapy"><a href="#了解Scrapy" class="headerlink" title="了解Scrapy"></a>了解Scrapy</h3><p>Scrapy是一个Python包，是一个爬取网页的框架。顾名思义，可以理解成Java中的抽象类。它负责流程性的逻辑，我们自己编写具体的处理逻辑。经过此次的使用，发现它确实是一个比较厉害的框架。首先，在爬取网页的过程中，你可能会遇到的问题，网上都有相应的解答；其次，我们只需要编写处理网页的逻辑和小的流程逻辑，这样我们可以更加专注爬取这件事本身，而不用关注使用什么技术来怎么爬。</p>
<h3 id="简易使用"><a href="#简易使用" class="headerlink" title="简易使用"></a>简易使用</h3><blockquote>
<p>网上的使用方法很多，这里只写一些关键性的步骤以及自己遇到的问题、解决办法。</p>
</blockquote>
<p>初始化项目：<code>scrapy startproject CSDNBlogMover</code></p>
<p>各个文件及目录的作用：</p>
<p><code>items.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义所需数据的属性，比如说，想爬取每一篇文章，此文件中则定义一些文章属性，如下：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CsdnblogmoverItem</span>(<span class="params">scrapy.Item</span>):</span></span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    link = scrapy.Field()</span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    time = scrapy.Field()</span><br><span class="line">    tags = scrapy.Field()</span><br><span class="line">    categories = scrapy.Field()</span><br><span class="line">    content = scrapy.Field()</span><br><span class="line">    comments = scrapy.Field()</span><br></pre></td></tr></table></figure>

<p><code>pipelines.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此文件可以理解成在某些关键时候，所要执行的操作，比如打开、关闭、处理爬虫这3个关键时候，与Android中Activity的生命周期类似</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CsdnblogmoverPipeline</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span>(<span class="params">self, spider</span>):</span></span><br><span class="line">        self.myconn = mysql_connection()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span>(<span class="params">self, spider</span>):</span></span><br><span class="line">        self.myconn.conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span>(<span class="params">self, item, spider</span>):</span></span><br><span class="line">        self.myconn.reconnect()</span><br><span class="line">        sql = <span class="string">&#x27;INSERT INTO wp_posts(post_author, post_excerpt, to_ping, pinged, post_content_filtered, post_date, post_date_gmt, post_content, post_title, post_modified, post_modified_gmt) VALUES (1, &quot; &quot;,&quot; &quot;, &quot; &quot;, &quot;&quot;, %s, %s, %s, %s, %s, %s)&#x27;</span></span><br><span class="line">        <span class="built_in">vars</span> = (get_uniformed_datetime(item[<span class="string">&#x27;time&#x27;</span>], DATE_FORMAT_CN), get_gmt_datetime(item[<span class="string">&#x27;time&#x27;</span>], DATE_FORMAT_CN), <span class="string">&#x27;&lt;!-- wp:html --&gt;\n&#x27;</span>+item[<span class="string">&#x27;content&#x27;</span>] + item[<span class="string">&#x27;comments&#x27;</span>] + <span class="string">&#x27;\n&lt;!-- /wp:html --&gt;&#x27;</span>, item[<span class="string">&#x27;title&#x27;</span>], get_now_datetime(), get_gmt_datetime(get_now_datetime()))</span><br><span class="line">        self.myconn.cursor.execute(sql, <span class="built_in">vars</span>)</span><br><span class="line">        </span><br><span class="line">        self.myconn.conn.commit()</span><br><span class="line">        print(item)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p><code>middlewares.py</code> </p>
<p>这个文件的作用在此次爬取博客中未使用到，但是也了解了部分内容，其实就是可以在这里面加上selenium，<strong>来处理动态加载的数据</strong>。</p>
<p><code>settings.py</code></p>
<p>这是一个配置类，里面有很多项，并且都有相应的注释，可以仔细看看。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BOT_NAME = <span class="string">&#x27;CSDNBlogMover&#x27;</span></span><br><span class="line"></span><br><span class="line">SPIDER_MODULES = [<span class="string">&#x27;CSDNBlogMover.spiders&#x27;</span>]</span><br><span class="line">NEWSPIDER_MODULE = <span class="string">&#x27;CSDNBlogMover.spiders&#x27;</span></span><br><span class="line">FEED_EXPORT_ENCODING = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;CSDNBlogMover.pipelines.CsdnblogmoverPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>爬取的关键：<code>spiders/CSDNBlogSpider.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要更换相应的Cookie，来确定你对此博客的拥有权，否则会抓取失败。</span></span><br><span class="line"><span class="comment"># 直接从浏览器的开发者工具中，打开编辑器时，所发出的请求的Cookie即可</span></span><br><span class="line">raw_cookie = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">items = raw_cookie.split(<span class="string">&#x27;; &#x27;</span>)</span><br><span class="line">cookies = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    kv = item.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    cookies[kv[<span class="number">0</span>]] = kv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(cookies)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CSDNBlogSpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    <span class="comment"># 名字，用来使用scrapy crawl csdn_spider来调用此爬虫</span></span><br><span class="line">    name = <span class="string">&#x27;csdn_spider&#x27;</span></span><br><span class="line">    <span class="comment"># 限定爬取的域名，如果域名不为此，则会爬取失败</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;blog.csdn.net&#x27;</span>, <span class="string">&#x27;mp.csdn.net&#x27;</span>]</span><br><span class="line">    author = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># self.browser = webdriver.Chrome()</span></span><br><span class="line">        <span class="comment"># self.browser.set_page_load_timeout(30)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">closed</span>(<span class="params">self, spider</span>):</span></span><br><span class="line">        print(<span class="string">&quot;spider closed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 爬虫入口</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span>(<span class="params">self</span>):</span></span><br><span class="line">        urls = [</span><br><span class="line">            <span class="string">&#x27;https://blog.csdn.net/asahinokawa&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">            self.author = url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># 返回一个Request，并指明：当请求发送成功，收到响应后，执行self.parse()回调</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=url, callback=self.parse)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 只负责爬取页数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="comment"># 获取总博客数</span></span><br><span class="line">        total_blog_cnt = response.xpath(</span><br><span class="line">            <span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/aside/div[@id=&quot;asideProfile&quot;]/div[2]/dl[1]/dd/a/span/text()&#x27;</span>).get()</span><br><span class="line">        <span class="keyword">if</span> total_blog_cnt <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> total_blog_cnt == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&#x27;total blog number parse error&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            total_blog_cnt = <span class="built_in">int</span>(total_blog_cnt)</span><br><span class="line">        <span class="comment"># 获取第1页的博客总数</span></span><br><span class="line">        <span class="keyword">if</span> response.status == <span class="number">200</span>:</span><br><span class="line">            links = response.xpath(<span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[2]/div[@data-articleid]/h4/a/@href&#x27;</span>)</span><br><span class="line">            raw_links = []</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                <span class="keyword">if</span> link.get().__contains__(self.author):</span><br><span class="line">                    <span class="comment"># yield scrapy.Request(link.get(), callback=self.parse_content)</span></span><br><span class="line">                    raw_links.append(link.get())</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">&#x27;%s not belong to author %s&#x27;</span> % (link, self.author))</span><br><span class="line">            <span class="comment"># 获取第1页博客数量</span></span><br><span class="line">            first_page_blog_cnt = <span class="built_in">len</span>(raw_links)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> first_page_blog_cnt &lt;= total_blog_cnt:  <span class="comment"># 不止一页</span></span><br><span class="line">                <span class="comment"># 通过总页数与第一页页数，来计算总共有多少页</span></span><br><span class="line">                pages = <span class="built_in">int</span>(math.ceil(total_blog_cnt / first_page_blog_cnt)) + <span class="number">1</span></span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">int</span>(pages)):</span><br><span class="line">                    page_url = <span class="string">&#x27;%s/article/list/%d&#x27;</span> % (response.url, idx)</span><br><span class="line">                    print(page_url)</span><br><span class="line">                    <span class="comment"># 返回爬取某页页面的请求</span></span><br><span class="line">                    <span class="keyword">yield</span> scrapy.Request(url=page_url, callback=self.parse_page)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.parse_page(self, response)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;对CSDN主页访问的响应异常，请检查URL&#x27;</span>)</span><br><span class="line">    <span class="comment"># 爬取某页页面的请求</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_page</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="keyword">if</span> response.status == <span class="number">200</span>:</span><br><span class="line">            links = response.xpath(<span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[2]/div[@data-articleid]/h4/a/@href&#x27;</span>)</span><br><span class="line">            <span class="comment"># 依次遍历所有的博客请求，并第每一个博客链接（即所有文章），进行文章页面爬取</span></span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                <span class="comment"># 包含作者</span></span><br><span class="line">                <span class="keyword">if</span> link.get().__contains__(self.author):</span><br><span class="line">                    <span class="keyword">yield</span> scrapy.Request(url=link.get(), callback=self.parse_content)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">&#x27;%s not belong to author %s, skipped&#x27;</span> % (link.get(), self.author))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;对CSDN中某页访问出错&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 爬取页面</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_content</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="keyword">if</span> response.status == <span class="number">200</span>:</span><br><span class="line">            data =  &#123;</span><br><span class="line">                <span class="string">&#x27;link&#x27;</span>: response.url,</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: response.xpath(</span><br><span class="line">                    <span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[@class=&quot;blog-content-box&quot;]/div[@class=&quot;article-header-box&quot;]/div[@class=&quot;article-header&quot;]/div[@class=&quot;article-title-box&quot;]/h1/text()&#x27;</span>).get(),</span><br><span class="line">                <span class="comment"># //*[@id=&quot;mainBox&quot;]/main/div[1]/div/div/div[2]/div[1]/span[1]</span></span><br><span class="line">                <span class="string">&#x27;time&#x27;</span>: response.xpath(</span><br><span class="line">                    <span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[@class=&quot;blog-content-box&quot;]/div[@class=&quot;article-header-box&quot;]/div[@class=&quot;article-header&quot;]/div[@class=&quot;article-info-box&quot;]/div[@class=&quot;article-bar-top&quot;]/span[@class=&quot;time&quot;]/text()&#x27;</span>).get(),</span><br><span class="line">                <span class="comment"># //*[@id=&quot;mainBox&quot;]/main/div[1]/div/div/div[2]/div[1]/span[3]/a</span></span><br><span class="line">                <span class="string">&#x27;tags&#x27;</span>: response.xpath(</span><br><span class="line">                    <span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[@class=&quot;blog-content-box&quot;]/div[@class=&quot;article-header-box&quot;]/div[@class=&quot;article-header&quot;]/div[@class=&quot;article-info-box&quot;]/div[@class=&quot;article-bar-top&quot;]/span[@class=&quot;tags-box artic-tag-box&quot;]/a/text()&#x27;</span>).get(),</span><br><span class="line">                <span class="comment"># //*[@id=&quot;mainBox&quot;]/main/div[1]/div/div/div[2]/div[1]/div/a</span></span><br><span class="line">                <span class="string">&#x27;categories&#x27;</span>: response.xpath(</span><br><span class="line">                    <span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[@class=&quot;blog-content-box&quot;]/div[@class=&quot;article-header-box&quot;]/div[@class=&quot;article-header&quot;]/div[@class=&quot;article-info-box&quot;]/div[@class=&quot;article-bar-top&quot;]/div[@class=&quot;tags-box space&quot;]/a/text()&#x27;</span>).get(),</span><br><span class="line">                <span class="comment"># //*[@id=&quot;mainBox&quot;]/main/div[1]/article</span></span><br><span class="line">                <span class="comment"># class=&quot;blog-content-box&quot;</span></span><br><span class="line">                <span class="string">&#x27;content&#x27;</span>: response.xpath(<span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[@class=&quot;blog-content-box&quot;]/article&#x27;</span>).get(),</span><br><span class="line">                <span class="comment"># //*[@id=&quot;mainBox&quot;]/main/div[3]/div[2]</span></span><br><span class="line">                <span class="string">&#x27;comments&#x27;</span>: response.xpath(</span><br><span class="line">                    <span class="string">&#x27;//*[@id=&quot;mainBox&quot;]/main/div[@class=&quot;comment-box&quot;]/div[@class=&quot;comment-list-container&quot;]&#x27;</span>).get()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 获取markdown文档</span></span><br><span class="line">            mark_down_url = <span class="string">&#x27;https://mp.csdn.net/mdeditor/getArticle?id=&#x27;</span> + <span class="built_in">str</span>(response.url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=mark_down_url,</span><br><span class="line">                                 callback=self.get_markdown_content,</span><br><span class="line">                                 meta=data,</span><br><span class="line">                                 <span class="comment"># Headers模拟浏览器的头部</span></span><br><span class="line">                                 headers=&#123;</span><br><span class="line">                                     <span class="string">&#x27;accept-encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate, br&#x27;</span>,</span><br><span class="line">                                     <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">                                     <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh,en;q=0.9,ja;q=0.8,zh-TW;q=0.7,fr;q=0.6,zh-CN;q=0.5&#x27;</span>,</span><br><span class="line">                                     <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36&#x27;</span>,</span><br><span class="line">                                 &#125;,</span><br><span class="line">                                 <span class="comment"># 需要更换相应的Cookie，来确定你对此博客的拥有权，否则会抓取失败</span></span><br><span class="line">                                 cookies=cookies)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;对CSDN中某篇文章访问出错&#x27;</span>)</span><br><span class="line">    <span class="comment"># 接收markdown内容，并作为Item的属性</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_markdown_content</span>(<span class="params">response</span>):</span></span><br><span class="line">        content = json.loads(response.body_as_unicode())</span><br><span class="line">        data = content[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;markdowncontent&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">            content = data[<span class="string">&#x27;markdowncontent&#x27;</span>]</span><br><span class="line">            <span class="comment"># print(&#x27;$$$$ == &#x27; + content)</span></span><br><span class="line">            response.meta[<span class="string">&#x27;content&#x27;</span>] = content</span><br><span class="line">            response.meta[<span class="string">&#x27;tags&#x27;</span>] = data[<span class="string">&#x27;tags&#x27;</span>]</span><br><span class="line">            response.meta[<span class="string">&#x27;categories&#x27;</span>] = data[<span class="string">&#x27;categories&#x27;</span>]</span><br><span class="line">            <span class="comment"># 此处返回的是一个完整的Item</span></span><br><span class="line">            <span class="keyword">return</span> response.meta</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;获取失败 : &#x27;</span>+response.meta[<span class="string">&#x27;link&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="关键性的API获取"><a href="#关键性的API获取" class="headerlink" title="关键性的API获取"></a>关键性的API获取</h3><p>在上面的处理中，对于Hexo来说，最为关键的API是获取markdown的API，这里记录一下发现的过程。此处要求原文是markdown格式，否则得到的markdown数据为空。</p>
<p><strong>第一步、在登录状态下，点开编辑</strong><br><img src="/images/pics/16703ff0849217e0c36f0e3c2404b970.jpg" alt="点开编辑"></p>
<p><strong>观察API</strong></p>
<p>链接：<code>https://mp.csdn.net/mdeditor/getArticle?id=89402970</code><br><img src="/images/pics/3e6c241100a7073f327c394d6a538210.jpg" alt="观察API"></p>
<p>入参为一个id加一些Headers（这里选择与浏览器保持一致），返回的参数为一个JSON串，里面的数据如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;89402970&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Flask如何使用logging.FileHandler将日志保存到文件&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;articleedittype&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;需求\n将日志尽可能往文件中输，自带的默认只输出到屏幕上。\n代码\n获取文件名\ndef get_custom_file_name():\n    def make_dir(make_dir_path):\n        path = make_dir_path.strip()\n        if not os.path.exists(path):\n            os.makedirs(pat...&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;&lt;h2&gt;&lt;a id=\&quot;_0\&quot;&gt;&lt;/a&gt;需求&lt;/h2&gt;\n&lt;p&gt;将日志尽可能往文件中输，自带的默认只输出到屏幕上。&lt;/p&gt;\n&lt;h2&gt;&lt;a id=\&quot;_3\&quot;&gt;&lt;/a&gt;代码&lt;/h2&gt;\n&lt;p&gt;获取文件名&lt;/p&gt;\n....&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;markdowncontent&quot;</span>: <span class="string">&quot;## 需求\n将日志尽可能往文件中输，自带的默认只输出到屏幕上。\n\n## 代码\n获取文件名\n```python\ndef get_custom_file_name():\n    def make_dir(make_dir_path):\n        path = make_dir_path.strip()\n        if not os.path.exists(path):\n            os.makedirs(path)\n        return path\n    log_dir = \&quot;ac_logs\&quot;\n    file_name = &#x27;logger-&#x27; + time.strftime(&#x27;%Y-%m-%d&#x27;, time.localtime(time.time())) + &#x27;.log&#x27;\n    file_folder = os.path.abspath(os.path.dirname(__file__)) + os.sep + log_dir\n    make_dir(file_folder)\n    return file_folder + os.sep + file_name\n```\n配置logging\n\n```python\ndictConfig(&#123;\n    &#x27;version&#x27;: 1,\n    &#x27;formatters&#x27;: &#123;&#x27;default&#x27;: &#123;\n        &#x27;format&#x27;: &#x27;%(asctime)s - %(levelname)s - %(filename)s - %(funcName)s - %(lineno)s - %(message)s&#x27;,\n    &#125;&#125;,\n    &#x27;handlers&#x27;: &#123;\n        &#x27;default&#x27;: &#123;\n            &#x27;class&#x27;: &#x27;logging.StreamHandler&#x27;,\n            &#x27;stream&#x27;: &#x27;ext://flask.logging.wsgi_errors_stream&#x27;,\n            &#x27;formatter&#x27;: &#x27;default&#x27;\n        &#125;,\n        &#x27;custom&#x27;: &#123;\n            &#x27;class&#x27; : &#x27;logging.FileHandler&#x27;,\n            &#x27;formatter&#x27;: &#x27;default&#x27;,\n            &#x27;filename&#x27; : get_custom_file_name(),\n            &#x27;encoding&#x27; : &#x27;utf-8&#x27;\n        &#125;,\n    &#125;,\n    &#x27;root&#x27;: &#123;\n        &#x27;level&#x27;: &#x27;INFO&#x27;,\n        &#x27;handlers&#x27;: [&#x27;custom&#x27;]\n    &#125;\n&#125;)\n```\n## 代码分析...&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;private&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;Flask,日志&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;categories&quot;</span>: <span class="string">&quot;Python&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;channel&quot;</span>: <span class="string">&quot;31&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;original&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;read_need_vip&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对图片的处理"><a href="#对图片的处理" class="headerlink" title="对图片的处理"></a>对图片的处理</h3><p>至此，所有格式为markdown的CSDN博客都被抓取下来，接下来就是对其中图片的处理。对于图片，初步的想法是，先把markdown中的图片下载下来，再随机命名，然后把原来markdown中的图片链接修改成改名之后的，图片的baseUrl使用gitee前缀，也就是说，把所有下载下来的图片都存到一个仓库中，（也算是作为一种备份吧）然后通过如下形式的地址，来访问该图片：<code>/images/pics/xxx.jpg</code>。处理代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> filetype <span class="keyword">as</span> filetype</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> = <span class="string">&quot;C:\\Users\\yangyu\\sasuraiu.github.io\\source\\_posts&quot;</span></span><br><span class="line">img_dir = <span class="string">&quot;C:\\Users\\yangyu\\sasuraiu.github.io\\source\\_posts\\images&quot;</span></span><br><span class="line">mds = os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">&#x27;!\[.*\]\(([^\)]+)\)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取markdown内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file_content</span>(<span class="params">path</span>):</span></span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(path):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                content = content + line</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># 修改markdown中的图片原地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_content</span>(<span class="params">content</span>):</span></span><br><span class="line">    changed = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> pic <span class="keyword">in</span> pattern.findall(content):</span><br><span class="line">        <span class="comment"># print(pic)</span></span><br><span class="line">        new_pic_link = download_pic(pic, img_dir, random_name())</span><br><span class="line">        <span class="keyword">if</span> new_pic_link <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            content = content.replace(pic, <span class="string">&#x27;/images/pics/&#x27;</span> + new_pic_link)</span><br><span class="line">            changed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> changed, content</span><br><span class="line"><span class="comment"># 随机名称</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_name</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">32</span>)).upper()</span><br><span class="line"><span class="comment"># 下载图片并重命名</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_pic</span>(<span class="params">url, path, name</span>):</span></span><br><span class="line">    <span class="keyword">import</span> requests</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">        filepath = path + <span class="string">&#x27;\\&#x27;</span> + name</span><br><span class="line">        <span class="comment"># 下载</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(r.content)</span><br><span class="line">        <span class="comment"># 重命名，通过文件魔数确定图片类型</span></span><br><span class="line">        <span class="comment"># 这里进行类型判断是为了避免格式错误导致的图片无法展示</span></span><br><span class="line">        kind = filetype.guess(filepath)</span><br><span class="line">        <span class="keyword">if</span> kind <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            print(<span class="string">&#x27;Cannot guess file type!&#x27;</span>)</span><br><span class="line">            os.remove(filepath)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            os.rename(filepath, filepath+<span class="string">&#x27;.&#x27;</span>+kind.extension)</span><br><span class="line">            <span class="keyword">return</span> name+<span class="string">&#x27;.&#x27;</span>+kind.extension</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(url)</span><br><span class="line">        print(<span class="string">&#x27;下载图片失败，请手动确认\n\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># 修改后保存回文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_back_file</span>(<span class="params">filepath, content</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> md <span class="keyword">in</span> mds:</span><br><span class="line">        print(<span class="string">&#x27;当前正在处理的文件为：&#x27;</span> + md)</span><br><span class="line">        filepath = <span class="built_in">dir</span> + <span class="string">&quot;\\&quot;</span> + md</span><br><span class="line">        <span class="comment"># 获取文件内容</span></span><br><span class="line">        content = get_file_content(filepath)</span><br><span class="line">        <span class="comment"># 解析文件中是否含有图片链接</span></span><br><span class="line">        <span class="keyword">if</span> content <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> content != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            changed, content = parse_content(content)</span><br><span class="line">            <span class="comment"># 替换回原文件</span></span><br><span class="line">            <span class="keyword">if</span> changed:</span><br><span class="line">                write_back_file(filepath, content)</span><br><span class="line">                print(<span class="string">&#x27;replaced original file with the latest link&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>至此，大部分重复性质的工作已经完成了，剩下就是对每一个篇文章进行格式检查。此爬虫的代码地址为（欢迎fork）：<a target="_blank" rel="noopener" href="https://github.com/sasuraiu/CSDNBlogMover">https://github.com/sasuraiu/CSDNBlogMover</a></p>
<h2 id="wordpress添加https访问"><a href="#wordpress添加https访问" class="headerlink" title="wordpress添加https访问"></a>wordpress添加https访问</h2><blockquote>
<p>docker中的wordpress</p>
</blockquote>
<h3 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h3><p>可以从<a target="_blank" rel="noopener" href="https://freessl.cn/">freessl.cn</a>免费申请。免费的SSL证书时间长度为1年，但是只能对单个域名，不支持多域名通配符，选择的话以个人需求为准。</p>
<p>选择浏览器生成<br><img src="/images/pics/00ebcb7bf40cf0e99bb5836d9c73e6e2.png" alt="步骤1"></p>
<p>点击确认创建后，得到如下信息：<br><img src="/images/pics/1865ace8ac84f727a214be5d32333eed.png" alt="步骤2"></p>
<p>接下来到域名管理里面，按上述信息配置域名的信息，可以参考上面的<a target="_blank" rel="noopener" href="https://blog.freessl.cn/free-certificate-verification-guide/">验证配置指南</a>，如下：<br><img src="/images/pics/790120c34cafbbf4c8d683c659078027.png" alt="步骤3"></p>
<p>配置完了之后，不一定会立马生效，取决于配置改解析项的TTL。</p>
<h3 id="apache配置"><a href="#apache配置" class="headerlink" title="apache配置"></a>apache配置</h3><ol>
<li><p>将容器里面的443端口映射到宿主机的443端口。如果已启动了容器，可能需要重新创建。</p>
</li>
<li><p>将申请好的证书和私钥上传到宿主机中，并将其挂载到容器中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run --name wp \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-p 443:443 \</span><br><span class="line">-e WORDPRESS_DB_HOST=host \</span><br><span class="line">-e WORDPRESS_DB_USER=user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=&quot;&quot; \</span><br><span class="line">-v /root/wordpress:/var/www/html \</span><br><span class="line">-v /root/ssl:/ssl \</span><br><span class="line">-d wordpress</span><br></pre></td></tr></table></figure>
</li>
<li><p>先进入容器中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container exec -it wp bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载apache的ssl模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a2enmod ssl</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改证书和私钥路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/sites-available/default-ssl.conf</span><br></pre></td></tr></table></figure>
<p>找到<code>SSLCertificateFile</code>和<code>SSLCertificateKeyFile</code>这两个配置项，改成把私钥和证书挂载进容器里面后的路径，这里都在<code>/ssl/</code>目录下。修改后为：<br><img src="/images/pics/cd4e780320650df67a0aea3121fad037.png" alt="apache ssl配置"></p>
</li>
<li><p>让ssl配置被apache加载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/default-ssl.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>退出容器，并重启容器。<br><code>docker container restart wp</code></p>
</li>
<li><p>强制http请求转到https<br>编辑 <code>/etc/apache2/sites-available/000-default.conf</code>，找到<code>&lt;VirtualHost *:80&gt; &lt;/VirtualHost&gt;</code>标签中增加下面的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> &quot;/<span class="attr">var</span>/<span class="attr">www</span>/<span class="attr">html</span>&quot;&gt;</span> </span><br><span class="line">    RewriteEngine   on</span><br><span class="line">    RewriteBase /</span><br><span class="line">    # FORCE HTTPS</span><br><span class="line">    RewriteCond %&#123;HTTPS&#125; !=on</span><br><span class="line">    RewriteRule ^/?(.*) https://%&#123;SERVER_NAME&#125;/$1 [R,L]</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下：<br><img src="/images/pics/07686b28801ce687923e75d59caf7a47.png" alt="http强跳https配置"></p>
</li>
<li><p>退出容器，并重启容器。<br><code>docker container restart wp</code></p>
</li>
</ol>
<h3 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h3><p>如果不能访问，可以往如下两方面考虑：</p>
<ol>
<li><p>查看容器的日志，看报什么错误信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container logs -f wp</span><br></pre></td></tr></table></figure>
</li>
<li><p>看宿主机的443端口是否开放</p>
</li>
</ol>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/yori_chen/article/details/88577249">https://blog.csdn.net/yori_chen/article/details/88577249</a></p>
<h2 id="从hexo批量迁移到wordpress"><a href="#从hexo批量迁移到wordpress" class="headerlink" title="从hexo批量迁移到wordpress"></a>从hexo批量迁移到wordpress</h2><blockquote>
<p>感觉”业务”有扩展，hexo不能动态添加文章有点不太适应</p>
</blockquote>
<h3 id="wordpress添加markdown支持"><a href="#wordpress添加markdown支持" class="headerlink" title="wordpress添加markdown支持"></a>wordpress添加markdown支持</h3><p>选择了<code>WP Editor.md</code>这个插件，新增post，测试markdown能够生效。</p>
<h3 id="获取hexo博客的md文档"><a href="#获取hexo博客的md文档" class="headerlink" title="获取hexo博客的md文档"></a>获取hexo博客的md文档</h3><p>在<code>source/_posts</code>下有所有的markdown文件，全都是博客的内容，并且是有一定的格式规律的。这里我需要的关于博客的数据有标题、发布日期、标签以及目录，当然还有博客正文。非常好解析。</p>
<p>读取所有md文件的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> = <span class="string">&quot;/xxxxx/blog-source/source/_posts&quot;</span></span><br><span class="line">files = os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    files = os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">    can_go_on = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        full_path = <span class="built_in">dir</span> + <span class="string">&#x27;/&#x27;</span> + file</span><br><span class="line">        print(full_path)</span><br><span class="line">		parse_md_file(full_path)</span><br><span class="line">        <span class="comment"># if count &gt;= 10:</span></span><br><span class="line">        <span class="comment"># break;</span></span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;Count: &quot;</span>, count)</span><br><span class="line">    print(count)</span><br></pre></td></tr></table></figure>

<h3 id="解析每个md文档"><a href="#解析每个md文档" class="headerlink" title="解析每个md文档"></a>解析每个md文档</h3><p>首先，是文件最开始有两个<code>---</code>，在这两个<code>---</code>之间的全部是文章的属性，之外的全是文章的内容。解析文章属性的时候，需要对文章的标签、目录做可能存在多个处理，所以用<code>list</code>存储。其中<code>post_meta_data_status</code>的各值的含义如下：</p>
<table>
<thead>
<tr>
<th>post_meta_data_status</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>初始状态，刚开始解析md文件</td>
</tr>
<tr>
<td>1</td>
<td>正在解析文章属性状态</td>
</tr>
<tr>
<td>2</td>
<td>文章属性解析完成，正在解析文章内容</td>
</tr>
</tbody></table>
<p>解析md文件的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_property</span>(<span class="params">line, splitter=<span class="string">&#x27;:&#x27;</span></span>):</span></span><br><span class="line">    items = line.split(splitter)</span><br><span class="line">    item = items[<span class="built_in">len</span>(items) - <span class="number">1</span>].strip()</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_md_file</span>(<span class="params">file_path, print_content=<span class="literal">False</span></span>):</span></span><br><span class="line">    title = <span class="string">&quot;&quot;</span></span><br><span class="line">    tag = []</span><br><span class="line">    category = []</span><br><span class="line">    last_item = []</span><br><span class="line">    date = <span class="string">&quot;&quot;</span></span><br><span class="line">    post_content = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        post_meta_data_status = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> post_meta_data_status == <span class="number">2</span>:</span><br><span class="line">                post_content += line</span><br><span class="line">                <span class="comment"># print(line, end=&#x27;&#x27;)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> line.__contains__(<span class="string">&quot;---&quot;</span>):</span><br><span class="line">                    <span class="keyword">if</span> post_meta_data_status == <span class="number">0</span>:</span><br><span class="line">                        post_meta_data_status = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        post_meta_data_status = <span class="number">2</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> line.__contains__(<span class="string">&quot;title&quot;</span>):</span><br><span class="line">                        title = get_property(line).strip()</span><br><span class="line">                    <span class="keyword">elif</span> line.__contains__(<span class="string">&quot;date&quot;</span>):</span><br><span class="line">                        date = get_property(line, <span class="string">&#x27;: &#x27;</span>).strip()</span><br><span class="line">                    <span class="keyword">elif</span> line.__contains__(<span class="string">&quot;tags&quot;</span>):</span><br><span class="line">                        item = get_property(line)</span><br><span class="line">                        <span class="keyword">if</span> item!=<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                            tag.append(item)</span><br><span class="line">                        last_item = tag</span><br><span class="line">                    <span class="keyword">elif</span> line.__contains__(<span class="string">&quot;categories&quot;</span>):</span><br><span class="line">                        item = get_property(line)</span><br><span class="line">                        <span class="keyword">if</span> item != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                            category.append(item)</span><br><span class="line">                        last_item = category</span><br><span class="line">                    <span class="keyword">elif</span> line.__contains__(<span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">                        item = get_property(line, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                        <span class="keyword">if</span> item != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                            last_item.append(item)</span><br><span class="line">        print(<span class="string">&quot;title: &quot;</span>, title)</span><br><span class="line">        print(<span class="string">&quot;date: &quot;</span>, date)</span><br><span class="line">        print(<span class="string">&quot;tags: &quot;</span>, tag)</span><br><span class="line">        print(<span class="string">&quot;categories: &quot;</span>, category)</span><br><span class="line">        date=datetime.datetime.strptime(date, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="将解析后的数据上传到wordpress"><a href="#将解析后的数据上传到wordpress" class="headerlink" title="将解析后的数据上传到wordpress"></a>将解析后的数据上传到wordpress</h3><p>上传主要用到了<a target="_blank" rel="noopener" href="https://pypi.org/project/python-wordpress-xmlrpc/">wordpress-xmlrpc</a>。其基本操作可参看<a target="_blank" rel="noopener" href="https://python-wordpress-xmlrpc.readthedocs.io/en/latest/examples/posts.html#working-with-posts">该官网上的用例</a>。</p>
<p>安装方式：<code>pip install python-wordpress-xmlrpc</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wordpress_xmlrpc <span class="keyword">import</span> Client, WordPressPost</span><br><span class="line"><span class="keyword">from</span> wordpress_xmlrpc.methods.posts <span class="keyword">import</span> GetPosts, NewPost</span><br><span class="line"><span class="keyword">from</span> wordpress_xmlrpc.methods.users <span class="keyword">import</span> GetUserInfo</span><br><span class="line"></span><br><span class="line">wp = Client(<span class="string">&#x27;http://www.wordpress.site/xmlrpc.php&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_post</span>(<span class="params">title, date, content, tag, category</span>):</span></span><br><span class="line">    post = WordPressPost()</span><br><span class="line">    post.title = title</span><br><span class="line">    post.content = content</span><br><span class="line">    post.post_status = <span class="string">&#x27;publish&#x27;</span></span><br><span class="line">	<span class="comment"># date为python的datetime类型</span></span><br><span class="line">    post.date = date</span><br><span class="line">    post.terms_names = &#123;</span><br><span class="line">        <span class="string">&#x27;post_tag&#x27;</span>: tag,</span><br><span class="line">        <span class="string">&#x27;category&#x27;</span>: category,</span><br><span class="line">    &#125;</span><br><span class="line">    post_id = wp.call(NewPost(post))</span><br><span class="line">    print(post_id)</span><br></pre></td></tr></table></figure>

<p>如果需要更新更多的post相关的信息，可参看<a target="_blank" rel="noopener" href="https://python-wordpress-xmlrpc.readthedocs.io/en/latest/ref/wordpress.html#WordPressPost">WordPressPost文档</a>。</p>
<h2 id="从halo迁移到hexo"><a href="#从halo迁移到hexo" class="headerlink" title="从halo迁移到hexo"></a>从halo迁移到hexo</h2><p><img src="/images/pics/6b91bb410de72df7d680045ea7684ebf.png"></p>
<blockquote>
<p>今年年初由 wordpress 迁移到 halo，主要是觉得懂点 Java，有什么定制化的需求，自己改代码会方便一些。但是也没有什么特别的需求需要定制，反而被这种东西折腾得忘记了写博客的初心。技术博客就应该简简单单，只写技术，博客怎么好看、怎么炫酷，都不重要。</p>
</blockquote>
<!-- more -->

<h3 id="配置说明-amp-前置条件"><a href="#配置说明-amp-前置条件" class="headerlink" title="配置说明&amp;前置条件"></a>配置说明&amp;前置条件</h3><ul>
<li>在 Halo 中，数据库使用的是 MySQL 5.7，并将 halo 服务所用数据库，内容导入到本地的数据库中，这样速度会快一些。</li>
<li>hexo 所用主题是 Icarus</li>
</ul>
<h3 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h3><p>总体思路：将 halo 的数据，导出成 hexo 所需要的格式。总体分为下面几个步骤：</p>
<ol>
<li>halo 字段与 hexo 字段对比<br>参考 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/front-matter">hexo 文档</a>，与之一一对应即可。后续根据 Icarus 的几个配置，又在 front-matter 里面添加了几个属性。</li>
</ol>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>layout</code></td>
<td align="left">布局</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>title</code></td>
<td align="left">标题</td>
<td align="left">文章的文件名</td>
</tr>
<tr>
<td align="left"><code>date</code></td>
<td align="left">建立日期</td>
<td align="left">文件建立日期</td>
</tr>
<tr>
<td align="left"><code>updated</code></td>
<td align="left">更新日期</td>
<td align="left">文件更新日期</td>
</tr>
<tr>
<td align="left"><code>comments</code></td>
<td align="left">开启文章的评论功能</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left"><code>tags</code></td>
<td align="left">标签（不适用于分页）</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>categories</code></td>
<td align="left">分类（不适用于分页）</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>permalink</code></td>
<td align="left">覆盖文章网址</td>
<td align="left"></td>
</tr>
</tbody></table>
<ol start="2">
<li><p>将 halo 的 tags、categories 转化成 hexo 里面的 tags、categories<br><img src="/images/pics/55d04423fe61c69e2efb76fabb60d186.png" alt="tag与post的关联关系"><br>category 与 tag 类似，都是通过一个关联表，与 post 建立关联关系。转换的逻辑自然变成了：根据 post_id 查 post_tags 表中的关联关系，得到 tag_id，再从 tag 表中获取 tag 的名称。</p>
</li>
<li><p>转化文章预览<br>这部分不太好转，直接用 markdown 有些 markdown 的语法符号，没办法过滤掉、或者过滤起来很难受。这里的做法是这样的：</p>
</li>
</ol>
<ul>
<li>在 front-matter 中添加 excerpt 属性</li>
<li>如果原文章(halo)中存在 summary，直接赋值给 excerpt</li>
<li>没有 summary，则先将 markdown 转化成 HTML，然后获取 HTML 中的前几个 dom 元素。</li>
</ul>
<p>文章属性</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	Title      <span class="keyword">string</span></span><br><span class="line">	Content    <span class="keyword">string</span></span><br><span class="line">	Password   <span class="keyword">string</span></span><br><span class="line">	Date       <span class="keyword">string</span></span><br><span class="line">	Updated    <span class="keyword">string</span></span><br><span class="line">	Thumbnail  <span class="keyword">string</span></span><br><span class="line">	Tags       []<span class="keyword">string</span></span><br><span class="line">	Categories []<span class="keyword">string</span></span><br><span class="line">	Summary    <span class="keyword">string</span></span><br><span class="line">	Priority   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主流程</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/go-sql-driver/mysql&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gomarkdown/markdown&quot;</span></span><br><span class="line">	<span class="string">&quot;html&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;path&quot;</span></span><br><span class="line">	<span class="string">&quot;regexp&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">	<span class="string">&quot;xorm.io/xorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	basePath := <span class="string">&quot;/Users/akina/hexo-blog/source/_posts&quot;</span></span><br><span class="line">	db, _ := xorm.NewEngine(<span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;root:root@tcp(localhost:3306)/halodb-tmp&quot;</span>)</span><br><span class="line">	db.ShowSQL(<span class="literal">true</span>)</span><br><span class="line">	queriedPosts, _ := db.Query(<span class="string">&quot;select * from posts&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> _, qp := <span class="keyword">range</span> queriedPosts &#123;</span><br><span class="line">		pid := qp[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">		post := Post&#123;</span><br><span class="line">			Title:     <span class="keyword">string</span>(qp[<span class="string">&quot;title&quot;</span>]),</span><br><span class="line">			Content:   html.UnescapeString(<span class="keyword">string</span>(qp[<span class="string">&quot;original_content&quot;</span>])),</span><br><span class="line">			Password:  <span class="keyword">string</span>(qp[<span class="string">&quot;password&quot;</span>]),</span><br><span class="line">			Date:      <span class="keyword">string</span>(qp[<span class="string">&quot;create_time&quot;</span>]),</span><br><span class="line">			Updated:   <span class="keyword">string</span>(qp[<span class="string">&quot;update_time&quot;</span>]),</span><br><span class="line">			Thumbnail: <span class="keyword">string</span>(qp[<span class="string">&quot;thumbnail&quot;</span>]),</span><br><span class="line">			Summary:   <span class="keyword">string</span>(qp[<span class="string">&quot;summary&quot;</span>]),</span><br><span class="line">			Priority:  <span class="keyword">string</span>(qp[<span class="string">&quot;top_priority&quot;</span>]),</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 处理标签</span></span><br><span class="line">		queriedTagIds, _ := db.Query(<span class="string">&quot;select tag_id from post_tags where post_id = &quot;</span> + <span class="keyword">string</span>(pid))</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(queriedTagIds) &gt; <span class="number">0</span> &#123;</span><br><span class="line">			tagIds := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">for</span> _, tagId := <span class="keyword">range</span> queriedTagIds &#123;</span><br><span class="line">				tagIds = <span class="built_in">append</span>(tagIds, <span class="keyword">string</span>(tagId[<span class="string">&quot;tag_id&quot;</span>]))</span><br><span class="line">			&#125;</span><br><span class="line">			queriedTagNames, _ := db.Query(fmt.Sprintf(<span class="string">&quot;select name from tags where id in (%s)&quot;</span>, strings.Join(tagIds, <span class="string">&quot;,&quot;</span>)))</span><br><span class="line">			tagNames := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">for</span> _, tagName := <span class="keyword">range</span> queriedTagNames &#123;</span><br><span class="line">				tagNames = <span class="built_in">append</span>(tagNames, <span class="keyword">string</span>(tagName[<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">			&#125;</span><br><span class="line">			post.Tags = tagNames</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 处理分类</span></span><br><span class="line">		queriedCategoryIds, _ := db.Query(<span class="string">&quot;select category_id from post_categories where post_id = &quot;</span> + <span class="keyword">string</span>(pid))</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(queriedCategoryIds) &gt; <span class="number">0</span> &#123;</span><br><span class="line">			categoryIds := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">for</span> _, categoryId := <span class="keyword">range</span> queriedCategoryIds &#123;</span><br><span class="line">				categoryIds = <span class="built_in">append</span>(categoryIds, <span class="keyword">string</span>(categoryId[<span class="string">&quot;category_id&quot;</span>]))</span><br><span class="line">			&#125;</span><br><span class="line">			queriedCategoryNames, _ := db.Query(fmt.Sprintf(<span class="string">&quot;select name from categories where id in (%s)&quot;</span>, strings.Join(categoryIds, <span class="string">&quot;,&quot;</span>)))</span><br><span class="line">			categoryNames := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">for</span> _, categoryName := <span class="keyword">range</span> queriedCategoryNames &#123;</span><br><span class="line">				categoryNames = <span class="built_in">append</span>(categoryNames, <span class="string">&quot;- [&quot;</span>+<span class="keyword">string</span>(categoryName[<span class="string">&quot;name&quot;</span>])+<span class="string">&quot;]&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">			post.Categories = categoryNames</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 写文件</span></span><br><span class="line">		postHexoData := strings.Join([]<span class="keyword">string</span>&#123;</span><br><span class="line">			<span class="string">&quot;---&quot;</span>,</span><br><span class="line">			<span class="string">&quot;title: \&quot;&quot;</span> + post.Title + <span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;date: &quot;</span> + post.Date,</span><br><span class="line">			<span class="string">&quot;updated: &quot;</span> + post.Updated,</span><br><span class="line">			<span class="string">&quot;tags: [&quot;</span> + strings.Join(post.Tags, <span class="string">&quot;,&quot;</span>) + <span class="string">&quot;]&quot;</span>,</span><br><span class="line">			<span class="string">&quot;categories: \n&quot;</span> + strings.Join(post.Categories, <span class="string">&quot;\n&quot;</span>),</span><br><span class="line">			<span class="string">&quot;thumbnail: &quot;</span> + post.Thumbnail,</span><br><span class="line">			<span class="string">&quot;password: &quot;</span> + post.Password,</span><br><span class="line">			<span class="string">&quot;excerpt: \&quot;&quot;</span> + getPostSummary(post) + <span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;top: &quot;</span> + post.Priority,</span><br><span class="line">			<span class="string">&quot;toc: true&quot;</span>,</span><br><span class="line">			<span class="string">&quot;---&quot;</span>,</span><br><span class="line">			post.Content,</span><br><span class="line">		&#125;, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">		ioutil.WriteFile(path.Join(basePath, post.Title+<span class="string">&quot;.md&quot;</span>), []<span class="keyword">byte</span>(postHexoData), <span class="number">0666</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取文章的预览</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getPostSummary</span><span class="params">(post Post)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> res <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">if</span> post.Summary != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		res = post.Summary</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		htmlContent := <span class="keyword">string</span>(markdown.ToHTML([]<span class="keyword">byte</span>(post.Content), <span class="literal">nil</span>, <span class="literal">nil</span>))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">4</span>; i++ &#123;</span><br><span class="line">			re := regexp.MustCompile(<span class="string">&quot;&lt;.*?&gt;.*?&lt;/.*?&gt;&quot;</span>)</span><br><span class="line">			label := <span class="keyword">string</span>(re.Find([]<span class="keyword">byte</span>(htmlContent)))</span><br><span class="line">			<span class="keyword">if</span> label == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			res = res + label</span><br><span class="line"></span><br><span class="line">			htmlContent = strings.ReplaceAll(htmlContent, label, <span class="string">&quot;&quot;</span>)</span><br><span class="line">			<span class="keyword">if</span> htmlContent == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, ch := <span class="keyword">range</span> []<span class="keyword">string</span>&#123;</span><br><span class="line">		<span class="string">&quot;\n&quot;</span>,</span><br><span class="line">	&#125; &#123;</span><br><span class="line">		res = strings.ReplaceAll(res, ch, <span class="string">&quot; &quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	res = strings.ReplaceAll(res, <span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line">	res = strings.TrimPrefix(res, <span class="string">&quot; &quot;</span>)</span><br><span class="line">	res = strings.TrimSuffix(res, <span class="string">&quot; &quot;</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(res)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>后续有几个需要改一下预览的内容，貌似不能通过 <code>hexo g</code>，原因是转义符的问题、单、双引号的问题等，只有少量，手动改了改，还算可以接受。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>折腾自建博客系列</p><p><a href="https://eucham.me/2020/09/05/795d32ee2085.html">https://eucham.me/2020/09/05/795d32ee2085.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>遇寻</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-09-05</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-12-31</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/hexo/">hexo</a><a class="link-muted mr-2" rel="tag" href="/tags/icarus/"> icarus</a><a class="link-muted mr-2" rel="tag" href="/tags/halo/">halo</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5f548d5caad6e60013d63db8&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/09/07/bcbf447aaf6e.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Golang面试题库</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/08/20/6ec2646852dc.html"><span class="level-item">0 | Golang：基础构建工具使用</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://eucham.me/2020/09/05/795d32ee2085.html';
            this.page.identifier = '2020/09/05/795d32ee2085.html';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'eucham' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/249b2dc63505.html"><img src="/images/pics/5300c911560a8d2e0d745dcaf025d22f.jpg" alt="M系列MacBook连接l2tp时失败的问题修复"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/249b2dc63505.html">M系列MacBook连接l2tp时失败的问题修复</a></p><p class="categories"><a href="/categories/macOS/">macOS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/e9036e8500f6.html"><img src="/images/thumbnails/rust-lang.png" alt="Rust学习笔记"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/e9036e8500f6.html">Rust学习笔记</a></p><p class="categories"><a href="/categories/Rust/">Rust</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/4948e86c1262.html"><img src="/images/pics/DrRvr9.jpg" alt="Calico证书学习笔记"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/4948e86c1262.html">Calico证书学习笔记</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/6dae87e31dc3.html"><img src="/images/pics/e9f22d889a230bfda8e24c0a981740a8.png" alt="如何在YAML文件中进行优雅地换行"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/6dae87e31dc3.html">如何在YAML文件中进行优雅地换行</a></p><p class="categories"><a href="/categories/Golang/">Golang</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/25470f32f4bb.html"><img src="/images/pics/kubernetes-cka-color.svg" alt="CKS证书学习资料汇编"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/25470f32f4bb.html">CKS证书学习资料汇编</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://crisfang.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Cris</span></span><span class="level-right"><span class="level-item tag">crisfang.com</span></span></a></li><li><a class="level is-mobile" href="https://sanyuesha.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">三月沙</span></span><span class="level-right"><span class="level-item tag">sanyuesha.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="遇寻笔记" height="28"></a><p class="is-size-7"><span>&copy; 2024 遇寻</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/eucham"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/eucham"><i class="fab fa-linkedin"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>