<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>分类: Android - 遇寻笔记</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="遇寻笔记"><meta name="msapplication-TileImage" content="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="遇寻笔记"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="No. I&amp;#39;ll bring me back a souvenir."><meta property="og:type" content="website"><meta property="og:title" content="遇寻笔记"><meta property="og:url" content="https://eucham.me/"><meta property="og:site_name" content="遇寻笔记"><meta property="og:description" content="No. I&amp;#39;ll bring me back a souvenir."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://eucham.me/img/og_image.png"><meta property="article:author" content="遇寻"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://eucham.me"},"headline":"遇寻笔记","image":["https://eucham.me/img/og_image.png"],"author":{"@type":"Person","name":"遇寻"},"publisher":{"@type":"Organization","name":"遇寻笔记","logo":{"@type":"ImageObject","url":"https://eucham.me/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"}},"description":"No. I&#39;ll bring me back a souvenir."}</script><link rel="icon" href="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?7d79380bb26079f6dd33da78e83cf2ab";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="遇寻笔记" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/categories/AI">AI</a><a class="navbar-item" href="/categories/Kubernetes">Kubernetes</a><a class="navbar-item" href="/categories/Openstack">Openstack</a><a class="navbar-item" href="/categories/Docker">Container</a><a class="navbar-item" href="/categories/Golang">Golang</a><a class="navbar-item" href="/categories/Rust">Rust</a><a class="navbar-item" href="/about.html">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/eucham"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/eucham"><i class="fab fa-linkedin"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">Android</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-04-08T06:58:12.000Z" title="4/8/2018, 2:58:12 PM">2018-04-08</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:41.962Z" title="2/9/2021, 11:03:41 AM">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">10 分钟读完 (大约1519个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/04/08/3ddbaba2d194.html">Service使用笔记</a></h1><div class="content"><blockquote>
<p>看过好几回了，但是还是好像每次都忘，可能是用得少，但是工作中看的一些源代码中用的太多了，可是每次用的时候都看一遍，有点浪费时间，还是自己做一个简单的总结，这样可能以后会快一些。</p>
</blockquote>
<p>这篇在草稿箱里实在是存太久了。。。</p>
<hr>
<h2 id="Service的分类"><a href="#Service的分类" class="headerlink" title="Service的分类"></a>Service的分类</h2><ul>
<li><p>启动型<br>通过调用<code>startService() </code>启动，一旦启动，服务即可在后台无限期运行，即使启动服务的组件已被销毁也不受影响。 已启动的服务通常是执行单一操作，而且不会将结果返回给调用方。</p>
</li>
<li><p>绑定型<br>通过调用<code>bindService()</code> 绑定到服务，服务即处于“绑定”状态。绑定服务提供了一个客户端-服务器接口，允许组件与服务进行交互、发送请求、获取结果，甚至是利用进程间通信 (IPC) 跨进程执行这些操作。 <em>仅当与另一个应用组件绑定时，绑定服务才会运行; 多个组件可以同时绑定到该服务，但全部取消绑定后，该服务即会被销毁</em>。</p>
</li>
</ul>
<p><strong>服务在其托管进程的主线程中运行，它既不创建自己的线程，也不在单独的进程中运行（除非另行指定）。</strong></p>
<h2 id="Service的生命周期"><a href="#Service的生命周期" class="headerlink" title="Service的生命周期"></a>Service的生命周期</h2><p>因为其分两类,所以它的生命周期也有两种:<br><img src="/images/pics/229b707972264550169d216ae68710f1.png" alt="图片1"></p>
<p>左边为启动型, 右边为绑定型.</p>
<h2 id="Service在清单文件中的属性"><a href="#Service在清单文件中的属性" class="headerlink" title="Service在清单文件中的属性"></a>Service在清单文件中的属性</h2><ul>
<li><code>android:exported</code>: 顾名思义,是否可以被导出,即是否可以被绑定用做服务端.<br><code> false</code>:确保服务仅适用于您的应用.<br><code>true</code>: 与false相反.</li>
</ul>
<p>请始终使用<strong>显式 Intent 启动</strong>或绑定 Service，且<strong>不要为服务声明 Intent 过滤器</strong>。</p>
<h2 id="启动型Service"><a href="#启动型Service" class="headerlink" title="启动型Service"></a>启动型Service</h2><h3 id="继承Service"><a href="#继承Service" class="headerlink" title="继承Service"></a>继承<code>Service</code></h3><p>若使用这种方法,则需要注意一个问题,那就是**<code>Service</code>默认的线程是主线程**, 不要在其中做耗时的事情.</p>
<h3 id="继承IntentService"><a href="#继承IntentService" class="headerlink" title="继承IntentService"></a>继承<code>IntentService</code></h3><p>使用这种方法, 就不需要担心线程的问题.因为其做为一个对<code>Service</code>的简单封装,它内部已经将所有的事件都放在了子线程中.不妨对其做一个简单的分析来加深对<code>Service</code>的理解.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    HandlerThread thread = </span><br><span class="line">	    <span class="keyword">new</span> HandlerThread(<span class="string">&quot;IntentService[&quot;</span> + mName + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    thread.start();</span><br><span class="line"></span><br><span class="line">    mServiceLooper = thread.getLooper();</span><br><span class="line">    mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在其<code>onCreate()</code>中,将开启一个初始化好<code>Looper</code>的子线程. 并为这个<code>Looper</code>的消息队列添加一个<code>Handler</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//IntentService.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServiceHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(looper);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        onHandleIntent((Intent)msg.obj);</span><br><span class="line">        stopSelf(msg.arg1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="meta">@Nullable</span> Intent intent)</span></span>;</span><br></pre></td></tr></table></figure>
<p>其中的<code>Handler</code>用来处理在这个子线程中的事务,其中的<code>onHandleIntent()</code>正是我们在继承<code>IntentService</code>时所需要实现的一个方法, 也就是说我们在其中写的方法都是在子线程中执行.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(<span class="meta">@Nullable</span> Intent intent, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">    Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">    msg.arg1 = startId;</span><br><span class="line">    msg.obj = intent;</span><br><span class="line">    mServiceHandler.sendMessage(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * You should not override this method for your IntentService. Instead,</span></span><br><span class="line"><span class="comment"> * override &#123;<span class="doctag">@link</span> #onHandleIntent&#125;, which the system calls when the IntentService</span></span><br><span class="line"><span class="comment"> * receives a start request.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> android.app.Service#onStartCommand</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(<span class="meta">@Nullable</span> Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">    onStart(intent, startId);</span><br><span class="line">    <span class="keyword">return</span> mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>onStart()</code>并没有太大的意义，只是一个普通的函数，重要的是它里面做的事情。它将从<code>onStartCommand()</code>里面得到的intent，通过message传递给handler，然后再是自己，对不同intent的处理。</p>
<p>对<code>onStartCommand()</code>的返回值，有下面三种：</p>
<ul>
<li><code>START_NOT_STICKY</code><br>如果系统在 onStartCommand() 返回后终止服务，则除非有挂起 Intent 要传递，否则系统不会重建服务。这是最安全的选项，可以避免在不必要时以及应用能够轻松重启所有未完成的作业时运行服务。</li>
<li><code>START_STICKY</code><br>如果系统在 onStartCommand() 返回后终止服务，则会重建服务并调用 onStartCommand()，但不会重新传递最后一个 Intent。相反，除非有挂起 Intent 要启动服务（在这种情况下，将传递这些 Intent ），否则系统会通过空 Intent 调用 onStartCommand()。这适用于不执行命令、但无限期运行并等待作业的媒体播放器（或类似服务）。</li>
<li><code>START_REDELIVER_INTENT</code><br>如果系统在 onStartCommand() 返回后终止服务，则会重建服务，并通过传递给服务的最后一个 Intent 调用 onStartCommand()。任何挂起 Intent 均依次传递。这适用于主动执行应该立即恢复的作业（例如下载文件）的服务。</li>
</ul>
<h3 id="如何停止"><a href="#如何停止" class="headerlink" title="如何停止"></a>如何停止</h3><p>启动服务必须管理自己的生命周期。也就是说，除非系统必须回收内存资源，否则系统不会停止或销毁服务，而且服务在 onStartCommand() 返回后会继续运行。<br>因此，服务必须通过调用<code>stopSelf() </code>自行停止运行，或者由另一个组件通过调用 <code>stopService() </code>来停止它。一旦请求使用 stopSelf() 或 stopService() 停止服务，系统就会尽快销毁服务。</p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/baidu_31405631/article/details/52469093">http://blog.csdn.net/baidu_31405631/article/details/52469093</a></p>
<h2 id="绑定型Service"><a href="#绑定型Service" class="headerlink" title="绑定型Service"></a>绑定型Service</h2><p>对于此种类型的，感觉自己用得到的地方并不是很多，但是要能够看得懂这这种类型的Service的代码，尤其是AIDL，在Android中非常常见。</p>
<p>AIDL的大致使用步骤如下：</p>
<ol>
<li>编写包含接口的aidl文件，make project，生成同名的java文件</li>
<li>AIDL是一种可跨进程的，就是说可以在进程A中，调用进程B中的方法，所以要首先要实现该方法类。实现其中的方法，只需要继承同名java文件中的Stub类，并实现其中的方法，即可。</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-04-07T07:39:49.000Z" title="4/7/2018, 3:39:49 PM">2018-04-07</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:04:05.185Z" title="2/9/2021, 11:04:05 AM">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">8 分钟读完 (大约1260个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/04/07/2983ade087a2.html">ButterKnife官方使用指南</a></h1><div class="content"><p>看到了<code>ButterKnife</code>之后，感觉它实在是太棒了，可以省略掉一大堆无趣的<code>findViewById()</code>，整个代码看起来都舒服多了。这篇使用说明来自它的官方网站的简易介绍，用起来非常简单，但是也是有挺多的情况，所以还是觉得自己翻译出来，方便以后查阅吧！</p>
<hr>
<p>使用<code>@BindView</code>和<code>ID</code>注解相应的变量，<code>ButterKnife</code>就会在你的<code>layout</code>文件中找到所对应的<code>View</code>并赋值给它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  <span class="meta">@BindView(R.id.title)</span> TextView title;</span><br><span class="line">  <span class="meta">@BindView(R.id.subtitle)</span> TextView subtitle;</span><br><span class="line">  <span class="meta">@BindView(R.id.footer)</span> TextView footer;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.simple_activity);</span><br><span class="line">    ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// TODO Use fields...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面例子中，所生成的代码大致与下面代码等同：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(ExampleActivity activity)</span> </span>&#123;</span><br><span class="line">  activity.subtitle = (android.widget.TextView) activity.findViewById(<span class="number">2130968578</span>);</span><br><span class="line">  activity.footer = (android.widget.TextView) activity.findViewById(<span class="number">2130968579</span>);</span><br><span class="line">  activity.title = (android.widget.TextView) activity.findViewById(<span class="number">2130968577</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="资源绑定"><a href="#资源绑定" class="headerlink" title="资源绑定"></a>资源绑定</h2><p>使用<code>@BindBool</code>, <code>@BindColor</code>, <code>@BindDimen</code>, <code>@BindDrawable</code>, <code>@BindInt</code>, <code>@BindString</code>与一个对应的<code>ID</code>来绑定定义好的资源，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  <span class="meta">@BindString(R.string.title)</span> String title;</span><br><span class="line">  <span class="meta">@BindDrawable(R.drawable.graphic)</span> Drawable graphic;</span><br><span class="line">  <span class="meta">@BindColor(R.color.red)</span> <span class="keyword">int</span> red; <span class="comment">// int or ColorStateList field</span></span><br><span class="line">  <span class="meta">@BindDimen(R.dimen.spacer)</span> Float spacer; <span class="comment">// int (for pixel size) or float (for exact value) field</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="非ACTIVITY绑定"><a href="#非ACTIVITY绑定" class="headerlink" title="非ACTIVITY绑定"></a>非ACTIVITY绑定</h2><p>我们还可以在已知<code>View</code>的情况下，在任意的对象中，绑定该<code>View</code>中所含有的控件。比如在<code>Fragment</code>中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FancyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">  <span class="meta">@BindView(R.id.button1)</span> Button button1;</span><br><span class="line">  <span class="meta">@BindView(R.id.button2)</span> Button button2;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    View view = inflater.inflate(R.layout.fancy_fragment, container, <span class="keyword">false</span>);</span><br><span class="line">    ButterKnife.bind(<span class="keyword">this</span>, view);</span><br><span class="line">    <span class="comment">// TODO Use fields...</span></span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外一个是在<code>ViewHolder</code>中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View view, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">    ViewHolder holder;</span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">      holder = (ViewHolder) view.getTag();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      view = inflater.inflate(R.layout.whatever, parent, <span class="keyword">false</span>);</span><br><span class="line">      holder = <span class="keyword">new</span> ViewHolder(view);</span><br><span class="line">      view.setTag(holder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    holder.name.setText(<span class="string">&quot;John Doe&quot;</span>);</span><br><span class="line">    <span class="comment">// etc...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@BindView(R.id.title)</span> TextView name;</span><br><span class="line">    <span class="meta">@BindView(R.id.job_title)</span> TextView jobTitle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">      ButterKnife.bind(<span class="keyword">this</span>, view);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其它的绑定方式"><a href="#其它的绑定方式" class="headerlink" title="其它的绑定方式"></a>其它的绑定方式</h2><p>可使用<code>Activity</code>当做一个根<code>View</code>可以绑定任何对象。如果你使用了<code>MVC</code>模式，你可以使用<code>ButterKnife.bind(this, activity)</code>来绑定<code>Controller</code>。<br>可使用<code>ButterKnife.bind(this)</code>来绑定一个<code>View</code>里面的子<code>View</code>。如果你在<code>layout</code>文件中使用了<code>&lt;merge&gt;</code>标签并且在<code>View</code>的构造器中填充，你可以在这之后立马调用它。或者，你也可以在<code>onFinishInflate()</code>回调中调用。</p>
<h2 id="VIEW-LISTS"><a href="#VIEW-LISTS" class="headerlink" title="VIEW LISTS"></a>VIEW LISTS</h2><p>将所需要的控件，全部填充到一个<code>List</code>中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindViews(&#123; R.id.first_name, R.id.middle_name, R.id.last_name &#125;)</span></span><br><span class="line">List&lt;EditText&gt; nameViews;</span><br></pre></td></tr></table></figure>

<p><code>apply()</code>方法可以对<code>List</code>中所有的<code>View</code>执行某个操作。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ButterKnife.apply(nameViews, DISABLE);</span><br><span class="line">ButterKnife.apply(nameViews, ENABLED, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<p>可以指定一些简单的动作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static final ButterKnife.Action&lt;View&gt; DISABLE &#x3D; new ButterKnife.Action&lt;View&gt;() &#123;</span><br><span class="line">  @Override public void apply(View view, int index) &#123;</span><br><span class="line">    view.setEnabled(false);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">static final ButterKnife.Setter&lt;View, Boolean&gt; ENABLED &#x3D; new ButterKnife.Setter&lt;View, Boolean&gt;() &#123;</span><br><span class="line">  @Override public void set(View view, Boolean value, int index) &#123;</span><br><span class="line">    view.setEnabled(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当然也可以在<code>apply()</code>方法中指定一个<code>Android</code>中控件的属性名。</p>
<p><code>ButterKnife.apply(nameViews, View.ALPHA, 0.0f);</code></p>
<h2 id="绑定LISTENER"><a href="#绑定LISTENER" class="headerlink" title="绑定LISTENER"></a>绑定LISTENER</h2><p>监听器也可以自动配置到相应的<code>View</code>上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnClick(R.id.submit)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TODO submit data to server...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>监听器函数的参数都是可选的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnClick(R.id.submit)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TODO submit data to server...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指定一个确定的类型，它将会被自动转换成之。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnClick(R.id.submit)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHi</span><span class="params">(Button button)</span> </span>&#123;</span><br><span class="line">  button.setText(<span class="string">&quot;Hello!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以为将一个监听器函数，绑定到多个控件上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnClick(&#123; R.id.door1, R.id.door2, R.id.door3 &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pickDoor</span><span class="params">(DoorView door)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (door.hasPrizeBehind()) &#123;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;You win!&quot;</span>, LENGTH_SHORT).show();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Try again&quot;</span>, LENGTH_SHORT).show();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义<code>View</code>时，绑定自己的监听器函数不需要设置<code>ID</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FancyButton</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">  <span class="meta">@OnClick</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// TODO do something!</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重置绑定"><a href="#重置绑定" class="headerlink" title="重置绑定"></a>重置绑定</h2><p><code>Fragment</code>和<code>Activity</code>的生命周期不同。当在<code>Fragment</code>的<code>onCreateView()</code>中使用了绑定，就需要在<code>onDestroyView()</code>中将变量置为<code>null</code>。<code>ButterKnife</code>在调用绑定时会返回一个<code>Unbinder</code>的实例，在适当的生命周期回调中，调用这个实例的<code>unbind()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FancyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">	<span class="meta">@BindView(R.id.button1)</span> Button button1;</span><br><span class="line">	<span class="meta">@BindView(R.id.button2)</span> Button button2;</span><br><span class="line">	<span class="keyword">private</span> Unbinder unbinder;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">		View view = inflater.inflate(R.layout.fancy_fragment, container, <span class="keyword">false</span>);</span><br><span class="line">		unbinder = ButterKnife.bind(<span class="keyword">this</span>, view);</span><br><span class="line">		<span class="comment">// TODO Use fields...</span></span><br><span class="line">		<span class="keyword">return</span> view;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroyView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onDestroyView();</span><br><span class="line">		unbinder.unbind();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其它绑定"><a href="#其它绑定" class="headerlink" title="其它绑定"></a>其它绑定</h2><p>通常<code>@Bind</code>和监听器绑定都是必须的。如果在目标<code>View</code>中为找到相应<code>ID</code>的控件，则会抛出异常。</p>
<p>为了抑制住这中异常，创建一个可选的绑定，可以使用<code>@Nullable</code>或<code>@Optional</code>来注解变量或方法。</p>
<p>注 : 可使用任何名为<code>@Nullable</code>的注解来注解变量，但推荐Android <code>support-annotations</code>中的<code>@Nullable</code> 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span> <span class="meta">@BindView(R.id.might_not_be_there)</span> TextView mightNotBeThere;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Optional</span> <span class="meta">@OnClick(R.id.maybe_missing)</span> <span class="function"><span class="keyword">void</span> <span class="title">onMaybeMissingClicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TODO ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多方法监听器"><a href="#多方法监听器" class="headerlink" title="多方法监听器"></a>多方法监听器</h2><p>可在注解中加入参数来区分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnItemSelected(R.id.list_view)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onItemSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TODO ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OnItemSelected(value = R.id.maybe_missing, callback = NOTHING_SELECTED)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onNothingSelected</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TODO ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><h3 id="GRADLE"><a href="#GRADLE" class="headerlink" title="GRADLE"></a>GRADLE</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.jakewharton:butterknife:(insert latest version)&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.jakewharton:butterknife-compiler:(insert latest version)&#x27;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-03-27T04:47:59.000Z" title="3/27/2018, 12:47:59 PM">2018-03-27</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:08:19.250Z" title="4/21/2022, 12:08:19 AM">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">4 分钟读完 (大约594个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/03/27/4a74bf2e6eac.html">通过反射来获取Intent中的Key</a></h1><div class="content">在项目中遇到一种情况，我想通过了解某个Intent里面到底存了哪些数据来解决这个问题。但是我们知道，Intent里面的数据需要知道key才能调用相应的函数取出来，所以如何才能找出这些key呢？通过对Intent代码里面对存数据的观察，我们可以看到，通过putExtra()存的数据，都放在一个叫做mE</div><a class="article-more button is-small is-size-7" href="/2018/03/27/4a74bf2e6eac.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-03-14T07:07:16.000Z" title="3/14/2018, 3:07:16 PM">2018-03-14</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:26.539Z" title="2/9/2021, 11:03:26 AM">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">10 分钟读完 (大约1434个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/03/14/175b2912dc35.html">系统应用闹钟之TabLayout的使用</a></h1><div class="content"><blockquote>
<p>此篇文章记录一些关于安卓原生应用闹钟里面TabLayout的使用，没见过用这个组件的源代码，想从它里面学习学习。就当是见见世面，顺便写个笔记。</p>
</blockquote>
<h2 id="先从印象到布局"><a href="#先从印象到布局" class="headerlink" title="先从印象到布局"></a>先从印象到布局</h2><p>原生闹钟给我的印象非常好，有种说不出的美感。在改工作上的问题时，顺便看它的样式，大致就是一个<code>TabLayout</code>加上四个<code>fragment</code>。</p>
<p>首先是头部的四个图标，是一个嵌在了<code>Toolbar</code>中的<code>TabLayout</code>。<code>Toolbar</code>也是一个<code>ViewGroup</code>，在它的里面放一个其他的控件也是理所当然，只是以前没试过。第一次看到这个写法，感觉非常好。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.support.design.widget.AppBarLayout</span><br><span class="line">android:layout_width=&quot;match_parent&quot;</span><br><span class="line">android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">android:background=&quot;@null&quot;</span><br><span class="line">app:elevation=&quot;0dp&quot;&gt;</span><br><span class="line">&lt;android.support.v7.widget.Toolbar</span><br><span class="line">    android:id=&quot;@+id/toolbar&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    app:contentInsetStart=&quot;0dp&quot;</span><br><span class="line">    tools:ignore=&quot;RtlSymmetry&quot;&gt;</span><br><span class="line">    &lt;android.support.design.widget.TabLayout</span><br><span class="line">        android:id=&quot;@+id/tabs&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        app:tabGravity=&quot;fill&quot;</span><br><span class="line">        app:tabIndicatorColor=&quot;@android:color/transparent&quot;</span><br><span class="line">        app:tabMaxWidth=&quot;0dp&quot;</span><br><span class="line">        app:tabMode=&quot;fixed&quot;</span><br><span class="line">        app:tabPaddingEnd=&quot;0dp&quot;</span><br><span class="line">        app:tabPaddingStart=&quot;0dp&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>Toolbar</code>下面就是一个<code>ViewPager</code>，存放在一个<code>FrameLayout</code>中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;FrameLayout</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v4.view.ViewPager</span><br><span class="line">        android:id=&quot;@+id/desk_clock_pager&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:importantForAccessibility=&quot;no&quot;</span><br><span class="line">        android:saveEnabled=&quot;false&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">&quot;@layout/drop_shadow&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样基本上大致的框架就出来了。接着看对它的初始化：<br>基本步骤和网上的教程是差不多的，只是其中的<code>UiDataModel</code>感觉非常有意思，感觉它几乎无所不能，用到的任何东西都可以往里面取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the tabs that make up the user interface.</span></span><br><span class="line">mTabLayout = (TabLayout) findViewById(R.id.tabs);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> tabCount = UiDataModel.getUiDataModel().getTabCount();</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> showTabLabel = getResources().getBoolean(R.bool.showTabLabel);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> showTabHorizontally = getResources().getBoolean(R.bool.showTabHorizontally);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tabCount; i++) &#123;</span><br><span class="line">    <span class="keyword">final</span> UiDataModel.Tab tabModel = UiDataModel.getUiDataModel().getTab(i);</span><br><span class="line">    <span class="keyword">final</span> <span class="meta">@StringRes</span> <span class="keyword">int</span> labelResId = tabModel.getLabelResId();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> TabLayout.Tab tab = mTabLayout.newTab()</span><br><span class="line">            .setTag(tabModel)</span><br><span class="line">            .setIcon(tabModel.getIconResId())</span><br><span class="line">            .setContentDescription(labelResId);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (showTabLabel) &#123;</span><br><span class="line">        tab.setText(labelResId);</span><br><span class="line">        tab.setCustomView(R.layout.tab_item);</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;ConstantConditions&quot;)</span></span><br><span class="line">        <span class="keyword">final</span> TextView text = (TextView) tab.getCustomView()</span><br><span class="line">                .findViewById(android.R.id.text1);</span><br><span class="line">        text.setTextColor(mTabLayout.getTabTextColors());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bind the icon to the TextView.</span></span><br><span class="line">        <span class="keyword">final</span> Drawable icon = tab.getIcon();</span><br><span class="line">        <span class="keyword">if</span> (showTabHorizontally) &#123;</span><br><span class="line">            <span class="comment">// Remove the icon so it doesn&#x27;t affect the minimum TabLayout height.</span></span><br><span class="line">            tab.setIcon(<span class="keyword">null</span>);</span><br><span class="line">            text.setCompoundDrawablesRelativeWithIntrinsicBounds(icon, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            text.setCompoundDrawablesRelativeWithIntrinsicBounds(<span class="keyword">null</span>, icon, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>打开<code>UiDataModel</code>，第一个引起我的关注的是一个枚举型，在其中保存了有关<code>Tab</code>的基本信息，如文本、图标资源id以及<strong>该Tab所对应的fragment</strong>等。第一次见到这种写法，有点震惊，同时觉得对于这种静态的应用，用枚举型去保存也符合常理，我觉得这种方法可以以后利用在我写的<code>Android</code>项目中，比如说我的应用中，Tab也是固定的，同时这样写可以让那些信息更加集中，修改起来更加方便，让代码的逻辑性更强。看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Identifies each of the primary tabs within the application. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Tab</span> </span>&#123;</span><br><span class="line">    ALARMS(AlarmClockFragment.class, R.drawable.ic_tab_alarm, R.string.menu_alarm),</span><br><span class="line">    CLOCKS(ClockFragment.class, R.drawable.ic_tab_clock, R.string.menu_clock),</span><br><span class="line">    TIMERS(TimerFragment.class, R.drawable.ic_tab_timer, R.string.menu_timer),</span><br><span class="line">    STOPWATCH(StopwatchFragment.class, R.drawable.ic_tab_stopwatch, R.string.menu_stopwatch);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mFragmentClassName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="meta">@DrawableRes</span> <span class="keyword">int</span> mIconResId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="meta">@StringRes</span> <span class="keyword">int</span> mLabelResId;</span><br><span class="line"></span><br><span class="line">    Tab(Class fragmentClass, <span class="meta">@DrawableRes</span> <span class="keyword">int</span> iconResId, <span class="meta">@StringRes</span> <span class="keyword">int</span> labelResId) &#123;</span><br><span class="line">        mFragmentClassName = fragmentClass.getName();</span><br><span class="line">        mIconResId = iconResId;</span><br><span class="line">        mLabelResId = labelResId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFragmentClassName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> mFragmentClassName; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@DrawableRes</span> <span class="function"><span class="keyword">int</span> <span class="title">getIconResId</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> mIconResId; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@StringRes</span> <span class="function"><span class="keyword">int</span> <span class="title">getLabelResId</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> mLabelResId; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>感觉自己简直被这源代码所陶醉。后面继续看关于<code>TabLayout</code>的初始化。这其中，对其的适配器的写法，我也是比较感兴趣的。因为自己在写应用的时候，遇到过关于<code>PagerAdapter</code>的问题，所以比较期待它是如何去实现的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Customize the view pager.</span></span><br><span class="line">mFragmentTabPagerAdapter = <span class="keyword">new</span> FragmentTabPagerAdapter(<span class="keyword">this</span>);</span><br><span class="line">mFragmentTabPager = (ViewPager) findViewById(R.id.desk_clock_pager);</span><br><span class="line"><span class="comment">// Keep all four tabs to minimize jank.</span></span><br><span class="line">mFragmentTabPager.setOffscreenPageLimit(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// Set Accessibility Delegate to null so view pager doesn&#x27;t intercept movements and</span></span><br><span class="line"><span class="comment">// prevent the fab from being selected.</span></span><br><span class="line">mFragmentTabPager.setAccessibilityDelegate(<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// Mirror changes made to the selected page of the view pager into UiDataModel.</span></span><br><span class="line">mFragmentTabPager.addOnPageChangeListener(<span class="keyword">new</span> PageChangeWatcher());</span><br><span class="line">mFragmentTabPager.setAdapter(mFragmentTabPagerAdapter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mirror changes made to the selected tab into UiDataModel.</span></span><br><span class="line">mTabLayout.addOnTabSelectedListener(<span class="keyword">new</span> TabLayout.OnTabSelectedListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabSelected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</span><br><span class="line">        UiDataModel.getUiDataModel().setSelectedTab((UiDataModel.Tab) tab.getTag());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabUnselected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabReselected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>适配器的源代码不完全贴出来，感觉都对不起这源代码。它继承自<code>ViewPager</code>，自己实现了其中的方法，具体如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This adapter produces the DeskClockFragments that are the content of the DeskClock tabs. The</span></span><br><span class="line"><span class="comment"> * adapter presents the tabs in LTR and RTL order depending on the text layout direction for the</span></span><br><span class="line"><span class="comment"> * current locale. To prevent issues when switching between LTR and RTL, fragments are registered</span></span><br><span class="line"><span class="comment"> * with the manager using position-independent tags, which is an important departure from</span></span><br><span class="line"><span class="comment"> * FragmentPagerAdapter.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FragmentTabPagerAdapter</span> <span class="keyword">extends</span> <span class="title">PagerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DeskClock mDeskClock;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The manager into which fragments are added. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FragmentManager mFragmentManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** A fragment cache that can be accessed before &#123;<span class="doctag">@link</span> #instantiateItem&#125; is called. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;UiDataModel.Tab, DeskClockFragment&gt; mFragmentCache;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The active fragment transaction if one exists. */</span></span><br><span class="line">    <span class="keyword">private</span> FragmentTransaction mCurrentTransaction;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The current fragment displayed to the user. */</span></span><br><span class="line">    <span class="keyword">private</span> Fragment mCurrentPrimaryItem;</span><br><span class="line"></span><br><span class="line">    FragmentTabPagerAdapter(DeskClock deskClock) &#123;</span><br><span class="line">        mDeskClock = deskClock;</span><br><span class="line">        mFragmentCache = <span class="keyword">new</span> ArrayMap&lt;&gt;(getCount());</span><br><span class="line">        mFragmentManager = deskClock.getFragmentManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UiDataModel.getUiDataModel().getTabCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position the left-to-right index of the fragment to be returned</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the fragment displayed at the given &#123;<span class="doctag">@code</span> position&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">DeskClockFragment <span class="title">getDeskClockFragment</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Fetch the tab the UiDataModel reports for the position.</span></span><br><span class="line">        <span class="keyword">final</span> UiDataModel.Tab tab = UiDataModel.getUiDataModel().getTabAt(position);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// First check the local cache for the fragment.</span></span><br><span class="line">        DeskClockFragment fragment = mFragmentCache.get(tab);</span><br><span class="line">        <span class="keyword">if</span> (fragment != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> fragment;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Next check the fragment manager; relevant when app is rebuilt after locale changes</span></span><br><span class="line">        <span class="comment">// because this adapter will be new and mFragmentCache will be empty, but the fragment</span></span><br><span class="line">        <span class="comment">// manager will retain the Fragments built on original application launch.</span></span><br><span class="line">        fragment = (DeskClockFragment) mFragmentManager.findFragmentByTag(tab.name());</span><br><span class="line">        <span class="keyword">if</span> (fragment != <span class="keyword">null</span>) &#123;</span><br><span class="line">            fragment.setFabContainer(mDeskClock);</span><br><span class="line">            mFragmentCache.put(tab, fragment);</span><br><span class="line">            <span class="keyword">return</span> fragment;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Otherwise, build the fragment from scratch.</span></span><br><span class="line">        <span class="keyword">final</span> String fragmentClassName = tab.getFragmentClassName();</span><br><span class="line">        fragment = (DeskClockFragment) Fragment.instantiate(mDeskClock, fragmentClassName);</span><br><span class="line">        fragment.setFabContainer(mDeskClock);</span><br><span class="line">        mFragmentCache.put(tab, fragment);</span><br><span class="line">        <span class="keyword">return</span> fragment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startUpdate</span><span class="params">(ViewGroup container)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (container.getId() == View.NO_ID) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;ViewPager with adapter &quot;</span> + <span class="keyword">this</span> + <span class="string">&quot; has no id&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">instantiateItem</span><span class="params">(ViewGroup container, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mCurrentTransaction == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCurrentTransaction = mFragmentManager.beginTransaction();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use the fragment located in the fragment manager if one exists.</span></span><br><span class="line">        <span class="keyword">final</span> UiDataModel.Tab tab = UiDataModel.getUiDataModel().getTabAt(position);</span><br><span class="line">        Fragment fragment = mFragmentManager.findFragmentByTag(tab.name());</span><br><span class="line">        <span class="keyword">if</span> (fragment != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCurrentTransaction.attach(fragment);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fragment = getDeskClockFragment(position);</span><br><span class="line">            mCurrentTransaction.add(container.getId(), fragment, tab.name());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fragment != mCurrentPrimaryItem) &#123;</span><br><span class="line">            FragmentCompat.setMenuVisibility(fragment, <span class="keyword">false</span>);</span><br><span class="line">            FragmentCompat.setUserVisibleHint(fragment, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fragment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroyItem</span><span class="params">(ViewGroup container, <span class="keyword">int</span> position, Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mCurrentTransaction == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCurrentTransaction = mFragmentManager.beginTransaction();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> DeskClockFragment fragment = (DeskClockFragment) object;</span><br><span class="line">        fragment.setFabContainer(<span class="keyword">null</span>);</span><br><span class="line">        mCurrentTransaction.detach(fragment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrimaryItem</span><span class="params">(ViewGroup container, <span class="keyword">int</span> position, Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Fragment fragment = (Fragment) object;</span><br><span class="line">        <span class="keyword">if</span> (fragment != mCurrentPrimaryItem) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCurrentPrimaryItem != <span class="keyword">null</span>) &#123;</span><br><span class="line">                FragmentCompat.setMenuVisibility(mCurrentPrimaryItem, <span class="keyword">false</span>);</span><br><span class="line">                FragmentCompat.setUserVisibleHint(mCurrentPrimaryItem, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fragment != <span class="keyword">null</span>) &#123;</span><br><span class="line">                FragmentCompat.setMenuVisibility(fragment, <span class="keyword">true</span>);</span><br><span class="line">                FragmentCompat.setUserVisibleHint(fragment, <span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            mCurrentPrimaryItem = fragment;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finishUpdate</span><span class="params">(ViewGroup container)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mCurrentTransaction != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCurrentTransaction.commitAllowingStateLoss();</span><br><span class="line">            mCurrentTransaction = <span class="keyword">null</span>;</span><br><span class="line">            mFragmentManager.executePendingTransactions();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isViewFromObject</span><span class="params">(View view, Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((Fragment) object).getView() == view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-03-14T05:41:40.000Z" title="3/14/2018, 1:41:40 PM">2018-03-14</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:08:31.803Z" title="4/21/2022, 12:08:31 AM">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">7 分钟读完 (大约1072个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/03/14/53dea99bd910.html">修改framework后如何编译、生效！生效！</a></h1><div class="content">被framework生效问题困了一天， 一定要记下来。试了网上各种答案，得到的结果都没生效。最终还是从同事那里得到的一份答案，还是同事靠谱啊。一、framework编译方法一般修改framework层的内容分为两种，一种是res，一种是源代码。前者只需要在其目录下，通过mm的方式即可将framewo</div><a class="article-more button is-small is-size-7" href="/2018/03/14/53dea99bd910.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-03-11T05:38:29.000Z" title="3/11/2018, 1:38:29 PM">2018-03-11</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:08:40.774Z" title="4/21/2022, 12:08:40 AM">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">6 分钟读完 (大约963个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/03/11/66fd5b4ee73f.html">插入耳机时安全音量提示</a></h1><div class="content">插入耳机的状态下，当音量达到某个值得时候，会弹出一个“继续提高音量将损害听力”的提示框。这只是一普通的对话框而已，但是这与需求不太一样，需要做一些微微的调整。源码的目录：Android 8.0中，位于：frameworks/base/packages/SystemUI/src/com/android</div><a class="article-more button is-small is-size-7" href="/2018/03/11/66fd5b4ee73f.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-01-21T01:05:54.000Z" title="1/21/2018, 9:05:54 AM">2018-01-21</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:48:38.579Z" title="4/21/2022, 12:48:38 AM">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">8 分钟读完 (大约1211个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/01/21/6591aea996f1.html">如何下载并导入Android系统源代码到Android Studio</a></h1><div class="content">下载源代码对于下载源代码这种操作，官方给的说明确实也是很详细。但是奈何GFW。所以用国内的源跑得比什么都快。网上也有很多教程，但是这些感觉是copy——因为它们都比不上国内源的网站上给的操作说明。国内有哪些Android的镜像源1. 中国科技大学2. 清华大学从上面的两个链接直接点进去便是帮助文档，</div><a class="article-more button is-small is-size-7" href="/2018/01/21/6591aea996f1.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-01-21T00:31:51.000Z" title="1/21/2018, 8:31:51 AM">2018-01-21</time>发表</span><span class="level-item"><time dateTime="2022-04-20T16:08:49.473Z" title="4/21/2022, 12:08:49 AM">2022-04-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">9 分钟读完 (大约1358个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/01/21/b00570593d4c.html">Android开发工具系之ADB</a></h1><div class="content">ADB的相关概念&amp;工作原理通过WLAN使用ADB感觉这个挺有意思，但是又在情理之中。1、电脑与设备连入同一个局域网，并能连通。2、将设备接上电脑，设置端口。λ adb tcpip 5555restarting in TCP mode port: 55553、断开设备4、找出设备的IP地址5、</div><a class="article-more button is-small is-size-7" href="/2018/01/21/b00570593d4c.html#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-12-25T22:51:12.000Z" title="12/26/2017, 6:51:12 AM">2017-12-26</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:23.303Z" title="2/9/2021, 11:03:23 AM">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">4 分钟读完 (大约562个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/26/f63384973df3.html">Android中的apk打包</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>使用友盟对应用进行信息收集时，其中包含有一个渠道名。渠道姑且可以认为是一个商店吧，如果应用要在很多个商店上面上架的话，一直改太麻烦了。有一个叫做多渠道打包的东西自然而然地走了过来。</p>
<h2 id="多渠道打包实现"><a href="#多渠道打包实现" class="headerlink" title="多渠道打包实现"></a>多渠道打包实现</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;UMENG_APPKEY&quot;</span><br><span class="line">    android:value=&quot;xxxxxxxxxxxxxxxxxxxxxx&quot; /&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;UMENG_CHANNEL&quot;</span><br><span class="line">    android:value=&quot;Google Play Store&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>如上所示，如果需要换一个渠道的话，重新改的话就特别麻烦了。先将其中的value替换成占位符<code>$&#123;UMENG_CHANNEL_VALUE&#125;</code>。接下来到模块下的<code>build.gradle</code>中进行相应的修改。修改大致如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;UMENG_CHANNEL&quot;</span><br><span class="line">    android:value=&quot;$&#123;UMENG_CHANNEL_NAME&#125;&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>接下来配置<code>build.gradle</code></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 默认是umeng的渠道</span></span><br><span class="line">    manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="string">&quot;umeng&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 友盟多渠道打包</span></span><br><span class="line">flavorDimensions <span class="string">&quot;wtf&quot;</span></span><br><span class="line">productFlavors&#123;</span><br><span class="line">    google &#123;</span><br><span class="line">        dimension <span class="string">&quot;wtf&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    coolapk &#123;</span><br><span class="line">        dimension <span class="string">&quot;wtf&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">productFlavors.all &#123; flavor -&gt;</span><br><span class="line">    flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自动设置应用签名"><a href="#自动设置应用签名" class="headerlink" title="自动设置应用签名"></a>自动设置应用签名</h2><p>在buildType{}前添加下段，并在buildType的release中添加<code>signingConfig signingConfigs.release</code></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line">    debug &#123;</span><br><span class="line">        <span class="comment">// No debug config</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    release &#123;</span><br><span class="line">        storeFile <span class="keyword">file</span>(<span class="string">&quot;../yourapp.keystore&quot;</span>)</span><br><span class="line">        storePassword <span class="string">&quot;your password&quot;</span></span><br><span class="line">        keyAlias <span class="string">&quot;your alias&quot;</span></span><br><span class="line">        keyPassword <span class="string">&quot;your password&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打release版本的包时就会使用其中所配置的签名了。</p>
<h2 id="修改AS生成的apk默认名"><a href="#修改AS生成的apk默认名" class="headerlink" title="修改AS生成的apk默认名"></a>修改AS生成的apk默认名</h2><p>不同gradle版本间存在一些差异，如果报错了，google修改一下。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    variant.outputs.all &#123; output -&gt;</span><br><span class="line"><span class="comment">//                    outputFileName = new File(</span></span><br><span class="line"><span class="comment">//                            &quot;JPreader-&quot; + $&#123;variant.productFlavors[0].name&#125; +</span></span><br><span class="line"><span class="comment">//                                    buildType.name + &quot;-v&quot; +</span></span><br><span class="line"><span class="comment">//                                    defaultConfig.versionName + &quot;-&quot; +</span></span><br><span class="line"><span class="comment">//                                    defaultConfig.versionCode + &quot;.apk&quot; )</span></span><br><span class="line">        <span class="keyword">if</span> (outputFile != <span class="keyword">null</span> &amp;&amp; outputFile.name.endsWith(<span class="string">&#x27;.apk&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 输出apk名称为ruijie_v1.0_wandoujia.apk</span></span><br><span class="line">            <span class="keyword">def</span> fileName = <span class="string">&quot;JPreader_v$&#123;defaultConfig.versionName&#125;_$&#123;variant.productFlavors[0].name&#125;.apk&quot;</span></span><br><span class="line">            outputFileName = <span class="keyword">new</span> <span class="keyword">File</span>(fileName)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><code>build.gradle</code>真的是神奇，有一些用法还是可以去学学。当前的<code>build.gradle</code>文件的整体如下所示：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">26</span></span><br><span class="line">    buildToolsVersion <span class="string">&#x27;26.0.2&#x27;</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;cn.xuchuanjun.nhknews&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">19</span></span><br><span class="line">        targetSdkVersion <span class="number">26</span></span><br><span class="line">        versionCode <span class="number">2</span></span><br><span class="line">        versionName <span class="string">&quot;1.1&quot;</span></span><br><span class="line">        testInstrumentationRunner <span class="string">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class="line"><span class="comment">//        jackOptions &#123;</span></span><br><span class="line"><span class="comment">//            enabled true</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//multiDexEnable true //突破应用方法数65535的一个限制</span></span><br><span class="line">        manifestPlaceholders=[UMENG_CHANNEL_NAME:<span class="string">&quot;Google Play Store&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        debug &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        myReleaseConfig &#123;</span><br><span class="line">            storeFile <span class="keyword">file</span>(<span class="string">&quot;xxxxxxxxxxxxxxxxx.jks&quot;</span>)</span><br><span class="line">            storePassword <span class="string">&quot;xxxxxxxx&quot;</span></span><br><span class="line">            keyAlias <span class="string">&quot;xxxxxx&quot;</span></span><br><span class="line">            keyPassword <span class="string">&quot;xxxxxxxx&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">            signingConfig signingConfigs.myReleaseConfig</span><br><span class="line"></span><br><span class="line">            applicationVariants.all &#123; variant -&gt;</span><br><span class="line">                variant.outputs.all &#123; output -&gt;</span><br><span class="line"><span class="comment">//                    outputFileName = new File(</span></span><br><span class="line"><span class="comment">//                            &quot;JPreader-&quot; + $&#123;variant.productFlavors[0].name&#125; +</span></span><br><span class="line"><span class="comment">//                                    buildType.name + &quot;-v&quot; +</span></span><br><span class="line"><span class="comment">//                                    defaultConfig.versionName + &quot;-&quot; +</span></span><br><span class="line"><span class="comment">//                                    defaultConfig.versionCode + &quot;.apk&quot; )</span></span><br><span class="line">                    <span class="keyword">if</span> (outputFile != <span class="keyword">null</span> &amp;&amp; outputFile.name.endsWith(<span class="string">&#x27;.apk&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// 输出apk名称为ruijie_v1.0_wandoujia.apk</span></span><br><span class="line">                        <span class="keyword">def</span> fileName = <span class="string">&quot;JPreader_v$&#123;defaultConfig.versionName&#125;_$&#123;variant.productFlavors[0].name&#125;.apk&quot;</span></span><br><span class="line">                        outputFileName = <span class="keyword">new</span> <span class="keyword">File</span>(fileName)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    flavorDimensions <span class="string">&quot;wtf&quot;</span></span><br><span class="line">    productFlavors&#123;</span><br><span class="line">        google &#123;</span><br><span class="line">            dimension <span class="string">&quot;wtf&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        coolapk &#123;</span><br><span class="line">            dimension <span class="string">&quot;wtf&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    productFlavors.all&#123;</span><br><span class="line">        flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_NAME:name]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        <span class="keyword">targetCompatibility</span> <span class="number">1.8</span></span><br><span class="line">        <span class="keyword">sourceCompatibility</span> <span class="number">1.8</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        <span class="keyword">flatDir</span> &#123;</span><br><span class="line">            dirs <span class="string">&#x27;libs&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-12-20T01:08:11.000Z" title="12/20/2017, 9:08:11 AM">2017-12-20</time>发表</span><span class="level-item"><time dateTime="2021-02-09T03:03:17.624Z" title="2/9/2021, 11:03:17 AM">2021-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">3 分钟读完 (大约480个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/20/fb56c6aa1402.html">Android中的签名</a></h1><div class="content"><p>签名，顾名思义与生活中的签名类似，为某个东西签了名，那么这个东西就与所签的名字产生了某种关系，如归属等。</p>
<h2 id="为什么要为Android应用签名？"><a href="#为什么要为Android应用签名？" class="headerlink" title="为什么要为Android应用签名？"></a>为什么要为Android应用签名？</h2><p>这是因为Android系统的要求就是这样，Android系统要求每一个Android应用程序必须要经过数字签名才能够安装到系统中，也就是说如果一个Android应用程序没有经过数字签名，就无法安装到系统中。</p>
<p>为什么在AS中直接RUN可以安装到系统上？<br>因为这种方式会使用Android Studio默认生成的debug签名，去给应用进行签名。</p>
<h2 id="签名不同会怎样"><a href="#签名不同会怎样" class="headerlink" title="签名不同会怎样"></a>签名不同会怎样</h2><p>如果同一应用使用不同的签名，那么将不能覆盖安装，必须先卸载之前的，然后再安装。</p>
<p>1）两个程序的入口Activity是否相同。两个程序如果包名不一样，即使其它所有代码完全一样，也不会被视为同一个程序的不同版本； 2）两个程序所采用的签名是否相同。如果两个程序所采用的签名不同，即使包名相同，也不会被视为同一个程序的不同版本，不能覆盖安装。</p>
<p>所以这也是为什么，同样一份代码，由不同的机器RUN，然后安装到同一台设备上时，需要先卸载之前的应用，而后再安装此次的。</p>
<p>原因就是每台机器默认生成的debug签名都不一样！</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>应用商城不接受用debug签名签的应用，必须使用自己的签名。</p>
<p>使用自己的签名可以避免应用不具备升级功能。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/Android/">上一页</a></div><div class="pagination-next"><a href="/categories/Android/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/Android/">1</a></li><li><a class="pagination-link is-current" href="/categories/Android/page/2/">2</a></li><li><a class="pagination-link" href="/categories/Android/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/249b2dc63505.html"><img src="/images/pics/5300c911560a8d2e0d745dcaf025d22f.jpg" alt="M系列MacBook连接l2tp时失败的问题修复"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/249b2dc63505.html">M系列MacBook连接l2tp时失败的问题修复</a></p><p class="categories"><a href="/categories/macOS/">macOS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/e9036e8500f6.html"><img src="/images/thumbnails/rust-lang.png" alt="Rust学习笔记"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/e9036e8500f6.html">Rust学习笔记</a></p><p class="categories"><a href="/categories/Rust/">Rust</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/4948e86c1262.html"><img src="/images/pics/DrRvr9.jpg" alt="Calico证书学习笔记"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/4948e86c1262.html">Calico证书学习笔记</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/6dae87e31dc3.html"><img src="/images/pics/e9f22d889a230bfda8e24c0a981740a8.png" alt="如何在YAML文件中进行优雅地换行"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/6dae87e31dc3.html">如何在YAML文件中进行优雅地换行</a></p><p class="categories"><a href="/categories/Golang/">Golang</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/25470f32f4bb.html"><img src="/images/pics/kubernetes-cka-color.svg" alt="CKS证书学习资料汇编"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/25470f32f4bb.html">CKS证书学习资料汇编</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://crisfang.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Cris</span></span><span class="level-right"><span class="level-item tag">crisfang.com</span></span></a></li><li><a class="level is-mobile" href="https://sanyuesha.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">三月沙</span></span><span class="level-right"><span class="level-item tag">sanyuesha.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="遇寻笔记" height="28"></a><p class="is-size-7"><span>&copy; 2024 遇寻</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/eucham"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/eucham"><i class="fab fa-linkedin"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>