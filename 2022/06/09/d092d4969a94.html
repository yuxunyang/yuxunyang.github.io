<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>å…³äº kubectl apply çš„æµç¨‹åˆ†æ - é‡å¯»ç¬”è®°</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="é‡å¯»ç¬”è®°"><meta name="msapplication-TileImage" content="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="é‡å¯»ç¬”è®°"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Server Side Applyèµ„æºè¯»å–Patch è®¡ç®—ä¸ APIServer äº¤äº’"><meta property="og:type" content="article"><meta property="og:title" content="å…³äº kubectl apply çš„æµç¨‹åˆ†æ"><meta property="og:url" content="https://eucham.me/2022/06/09/d092d4969a94.html"><meta property="og:site_name" content="é‡å¯»ç¬”è®°"><meta property="og:description" content="Server Side Applyèµ„æºè¯»å–Patch è®¡ç®—ä¸ APIServer äº¤äº’"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://eucham.me/images/pics/e9f22d889a230bfda8e24c0a981740a8.png"><meta property="article:published_time" content="2022-06-09T09:36:30.782Z"><meta property="article:modified_time" content="2022-06-13T15:25:25.545Z"><meta property="article:author" content="é‡å¯»"><meta property="article:tag" content="kubernetes"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/pics/e9f22d889a230bfda8e24c0a981740a8.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://eucham.me/2022/06/09/d092d4969a94.html"},"headline":"å…³äº kubectl apply çš„æµç¨‹åˆ†æ","image":["https://eucham.me/images/pics/e9f22d889a230bfda8e24c0a981740a8.png"],"datePublished":"2022-06-09T09:36:30.782Z","dateModified":"2022-06-13T15:25:25.545Z","author":{"@type":"Person","name":"é‡å¯»"},"publisher":{"@type":"Organization","name":"é‡å¯»ç¬”è®°","logo":{"@type":"ImageObject","url":"https://eucham.me/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"}},"description":"Server Side Applyèµ„æºè¯»å–Patch è®¡ç®—ä¸ APIServer äº¤äº’"}</script><link rel="canonical" href="https://eucham.me/2022/06/09/d092d4969a94.html"><link rel="icon" href="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?7d79380bb26079f6dd33da78e83cf2ab";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="é‡å¯»ç¬”è®°" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/categories/AI">AI</a><a class="navbar-item" href="/categories/Kubernetes">Kubernetes</a><a class="navbar-item" href="/categories/Openstack">Openstack</a><a class="navbar-item" href="/categories/Docker">Container</a><a class="navbar-item" href="/categories/Golang">Golang</a><a class="navbar-item" href="/categories/Rust">Rust</a><a class="navbar-item" href="/about.html">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/eucham"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/eucham"><i class="fab fa-linkedin"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-06-09T09:36:30.782Z" title="6/9/2022, 5:36:30 PM">2022-06-09</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-06-13T15:25:25.545Z" title="6/13/2022, 11:25:25 PM">2022-06-13</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/Kubernetes/">Kubernetes</a></span><span class="level-item">11 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1717ä¸ªå­—)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>æ¬¡è®¿é—®</span></div></div><h1 class="title is-3 is-size-4-mobile">å…³äº kubectl apply çš„æµç¨‹åˆ†æ</h1><div class="content"><blockquote>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸ <code>kubectl apply</code> ç›¸å…³çš„å‡ ä¸ªæ¦‚å¿µã€ç›¸å…³æ“ä½œçš„ä¸»è¦é€»è¾‘ï¼Œä¸»è¦åŒ…æ‹¬ <code>Server Side Apply</code>ã€<code>Client Side Apply</code>ã€‚</p>
</blockquote>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><blockquote>
<p>è¿™é‡Œå…¶å®å¯ä»¥ç›´æ¥ç”¨ <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes">kubernetes ä»“åº“</a>ï¼Œä½†å®ƒé‡Œé¢çš„å†…å®¹å¤ªå¤šï¼Œå¦‚æœåªç”¨ <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubectl.git">kubectl ä»“åº“</a> çœ‹èµ·æ¥ä¼šæ›´ç®€æ´ã€çº¯ç²¹ã€‚</p>
</blockquote>
<ul>
<li>Kubernetes é›†ç¾¤</li>
<li>å…‹éš† <code>kubectl</code> çš„æºä»£ç åˆ°æœ¬åœ°ç”¨ GoLand æ‰“å¼€<ul>
<li><code>git clone https://github.com/kubernetes/kubectl.git</code></li>
</ul>
</li>
<li>å°†ç¨‹åºå…¥å£æ‹·è´è¿› <code>kubectl</code> ä¸­ã€‚<ul>
<li><code>cd kubectl</code></li>
<li><code>wget https://github.com/kubernetes/kubernetes/blob/master/cmd/kubectl/kubectl.go</code></li>
</ul>
</li>
<li>ä¿®æ”¹ <code>doc.go</code> ä¸­åŒ…åä¸º <code>main</code></li>
<li>ç›´æ¥è·‘ <code>kubectl.go</code> ä¸­çš„ <code>main</code> æ–¹æ³•æ¥ä»æºç ç¼–è¯‘ã€å¯åŠ¨ <code>kubectl</code> å‘½ä»¤ã€‚<ul>
<li>æ·»åŠ å¦‚ä¸‹å‘½ä»¤å‚æ•°ï¼š<code>apply -f testdata/apply/cm.yaml --field-manager=some-controller</code></li>
</ul>
</li>
</ul>
<h2 id="Client-Side-Apply"><a href="#Client-Side-Apply" class="headerlink" title="Client Side Apply"></a>Client Side Apply</h2><p>å…¥å£åœ¨ <code>pkg/cmd/apply/apply.go</code> ä¸­çš„ <code>cmdutil.CheckErr(o.Run())</code>ã€‚</p>
<h3 id="â‘ -èµ„æºè¯»å–"><a href="#â‘ -èµ„æºè¯»å–" class="headerlink" title="â‘  èµ„æºè¯»å–"></a>â‘  èµ„æºè¯»å–</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">infos, err := o.GetObjects()</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ä¼šå°† <code>kubectl apply</code> å‘½ä»¤å°†è¦æ“ä½œçš„å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æœ¬åœ°çš„æ–‡ä»¶ã€æ–‡ä»¶å¤¹ç­‰ï¼‰åŠ è½½åˆ°åˆ°å†…å­˜ä¸­ï¼Œä¿å­˜åœ¨ <code>info.Object</code> ä¸­ï¼Œå¹¶è¿”å› <code>infos</code> åˆ—è¡¨ã€‚å½“æŠŠæ‰€æœ‰éœ€è¦ <code>apply</code> çš„å¯¹è±¡è¯»å‡ºæ¥åï¼Œä¼šé€šè¿‡ <code>for</code> å¾ªç¯å»ä¾æ¬¡åš <code>apply</code> æ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, info := <span class="keyword">range</span> infos &#123;</span><br><span class="line">	<span class="keyword">if</span> err := o.applyOneObject(info); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		errs = <span class="built_in">append</span>(errs, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œå¯¹æ¯ä¸ªèµ„æºçš„ <code>apply</code> æ“ä½œæ˜¯åˆ†éš”å¼€æ¥çš„ï¼ŒåŒæ—¶ï¼Œå¤„ç†çš„é€»è¾‘ä¹Ÿè¿›å…¥åˆ° <code>o.applyOneObject(info)</code> ä¸­ã€‚</p>
<h3 id="â‘¡-å¤„ç†ç¬¬ä¸€æ¬¡-apply-æ“ä½œ"><a href="#â‘¡-å¤„ç†ç¬¬ä¸€æ¬¡-apply-æ“ä½œ" class="headerlink" title="â‘¡ å¤„ç†ç¬¬ä¸€æ¬¡ apply æ“ä½œ"></a>â‘¡ å¤„ç†ç¬¬ä¸€æ¬¡ apply æ“ä½œ</h3><blockquote>
<p>ğŸ“¢æ³¨æ„ï¼šæ­¤å¤„çš„ <code>info.Object</code> æ˜¯åˆšä» kubectl client ç«¯åŠ è½½è¿›æ¥çš„å†…å®¹ã€‚</p>
</blockquote>
<p>åœ¨ä» k8s é›†ç¾¤ä¸­è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢å‰ï¼Œä¼šå…ˆè®¡ç®—å‡ºä¸€ä¸ª <code>modified</code>ï¼Œå®ƒè¡¨ç¤ºæ­¤æ¬¡ <code>apply</code> ç»“æŸåï¼Œåœ¨ç›®æ ‡é›†ç¾¤ä¸­è¯¥èµ„æºçš„ç»ˆæ€ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modified, err := util.GetModifiedConfiguration(info.Object, <span class="literal">true</span>, unstructured.UnstructuredJSONScheme)</span><br></pre></td></tr></table></figure>

<p><code>modified</code> çš„è®¡ç®—é€»è¾‘æ˜¯å…ˆä» <code>info.Object</code> ä¸­åˆ é™¤ <code>kubectl.kubernetes.io/last-applied-configuration</code>ï¼Œç„¶åå°† <code>info.Object</code> æœ¬èº«ä½œä¸º <code>kubectl.kubernetes.io/last-applied-configuration</code> çš„å€¼å¡è¿›å»ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetModifiedConfiguration</span><span class="params">(obj runtime.Object, annotate <span class="keyword">bool</span>, codec runtime.Encoder)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> modified []<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line">	annots, err := metadataAccessor.Annotations(obj)</span><br><span class="line"></span><br><span class="line">	original := annots[v1.LastAppliedConfigAnnotation]</span><br><span class="line">	<span class="built_in">delete</span>(annots, v1.LastAppliedConfigAnnotation)</span><br><span class="line">	<span class="keyword">if</span> err := metadataAccessor.SetAnnotations(obj, annots); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ­¤æ—¶ modified ç­‰äº info.Object çš„ Annotation å‡å» kubectl.kubernetes.io/last-applied-configuration</span></span><br><span class="line">	modified, err = runtime.Encode(codec, obj)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> annotate &#123;</span><br><span class="line">    <span class="comment">// å°†æ­¤æ—¶çš„ modified ä½œä¸º kubectl.kubernetes.io/last-applied-configuration å¡è¿› Annotation ä¸­</span></span><br><span class="line">		annots[v1.LastAppliedConfigAnnotation] = <span class="keyword">string</span>(modified)</span><br><span class="line">		<span class="keyword">if</span> err := metadataAccessor.SetAnnotations(obj, annots); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// é‡æ–°ç”Ÿæˆ modified</span></span><br><span class="line">		modified, err = runtime.Encode(codec, obj)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	annots[v1.LastAppliedConfigAnnotation] = original</span><br><span class="line">	<span class="keyword">if</span> err := metadataAccessor.SetAnnotations(obj, annots); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> modified, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç¬¬ä¸€æ¬¡ <code>apply</code> æŸä¸ªèµ„æºåˆ° k8s é›†ç¾¤ä¸­æ—¶ï¼Œä¼šæ˜¾å¼åœ°æ‰§è¡Œåˆ›å»ºé€»è¾‘ã€‚å¯¹äºæ˜¯å¦æ‰§è¡Œåˆ›å»ºé€»è¾‘ï¼Œåˆ™é€šè¿‡ä¸€æ¬¡å¯¹è¯¥èµ„æºçš„æŸ¥è¯¢æ“ä½œæ¥ç¡®å®šã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err := info.Get(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> !errors.IsNotFound(err) &#123;</span><br><span class="line">		<span class="keyword">return</span> ...</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> o.DryRunStrategy != cmdutil.DryRunClient &#123;</span><br><span class="line">		<span class="comment">// Then create the resource and skip the three-way merge</span></span><br><span class="line">		obj, err := helper.Create(info.Namespace, <span class="literal">true</span>, info.Object)</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		info.Refresh(obj, <span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœèµ„æºå­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿›å…¥è¯¥ if è¯­å¥ï¼Œä¸”èƒ½å¤Ÿ<strong>è·å–åˆ°é›†ç¾¤ä¸­è¯¥èµ„æºçš„å®šä¹‰</strong>ï¼Œå¹¶è¦†ç›– <code>info.Object</code> å­—æ®µã€‚</p>
<blockquote>
<p>ğŸ“¢æ³¨æ„ï¼šæ­¤æ—¶çš„ <code>info.Object</code> å°±å˜æˆäº†èµ„æºåœ¨ k8s é›†ç¾¤ä¸­çš„å®šä¹‰ã€‚</p>
</blockquote>
<h3 id="â‘¢-å®¢æˆ·ç«¯é‡è¯•æœºåˆ¶"><a href="#â‘¢-å®¢æˆ·ç«¯é‡è¯•æœºåˆ¶" class="headerlink" title="â‘¢ å®¢æˆ·ç«¯é‡è¯•æœºåˆ¶"></a>â‘¢ å®¢æˆ·ç«¯é‡è¯•æœºåˆ¶</h3><p>å½“ <code>apply</code> çš„èµ„æºåœ¨ k8s é›†ç¾¤ä¸­å·²å­˜åœ¨æ—¶ï¼Œä¼šå…ˆåˆ›å»º <code>Patcher</code>ï¼Œç„¶åè°ƒç”¨ <code>patcher.Patch()</code> æ–¹æ³•æ¥å®Œæˆ patch æ“ä½œã€‚å…¶ä¸­è¯¥å‡½æ•°çš„å…¥å‚æ³¨é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li><code>current runtime.Object</code>: å½“å‰é›†ç¾¤ä¸­è¯¥èµ„æºçš„å®šä¹‰ã€‚</li>
<li><code>modified []byte</code>: å‚ç…§ç¬¬â‘¡æ­¥ä¸­çš„è§£é‡Š</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–å…¥å‚</span></span><br><span class="line">helper := resource.NewHelper(info.Client, info.Mapping).</span><br><span class="line">		DryRun(o.DryRunStrategy == cmdutil.DryRunServer).</span><br><span class="line">		WithFieldManager(o.FieldManager).</span><br><span class="line">		WithFieldValidation(o.ValidationDirective)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º patcher</span></span><br><span class="line">patcher, err := newPatcher(o, info, helper)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œ Patch æ“ä½œ</span></span><br><span class="line">patchBytes, patchedObject, err := </span><br><span class="line">	patcher.Patch(info.Object, modified, info.Source, info.Namespace, info.Name, o.ErrOut)</span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ <code>patcher.Patch()</code> ä¹‹åï¼Œæ˜¯ä¸€ä¸ªç‰¹åˆ«ç†Ÿæ‚‰çš„ <code>for</code> å¾ªç¯ã€‚ç›®çš„æ˜¯å½“é‡åˆ°<strong>å†²çª</strong>æ—¶ï¼Œï¼ˆé»˜è®¤5æ¬¡ï¼‰è¿›è¡Œ <code>maxPatchRetry</code> é‡è¯•ã€‚æ‰§è¡Œçš„ä¸»ä½“å‡½æ•°æ˜¯ <code>p.patchSimple()</code>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">patchBytes, patchObject, err := p.patchSimple(current, modified, source, namespace, name, errOut)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= p.Retries &amp;&amp; errors.IsConflict(err); i++ &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	current, getErr = p.Helper.Get(namespace, name)</span><br><span class="line">	patchBytes, patchObject, err = p.patchSimple(current, modified, source, namespace, name, errOut)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†æä¸‹ <code>p.patchSimple()</code> çš„å…¥å‚ï¼š</p>
<ul>
<li><code>current -&gt; obj </code>: å½“å‰é›†ç¾¤ä¸­è¯¥èµ„æºçš„å®šä¹‰ã€‚</li>
<li><code>modified</code>: å‚ç…§ç¬¬â‘¡æ­¥ä¸­çš„è§£é‡Šã€‚</li>
</ul>
<h3 id="â‘£-è®¡ç®—-Patch"><a href="#â‘£-è®¡ç®—-Patch" class="headerlink" title="â‘£ è®¡ç®— Patch"></a>â‘£ è®¡ç®— Patch</h3><p>è¿›å…¥ <code>patchSimple()</code> åï¼Œä¸»è¦åšçš„æ“ä½œå°±æ˜¯å…ˆè®¡ç®— patch çš„å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹æ˜¯æŒ‡<strong>å®¢æˆ·ç«¯</strong>é€šè¿‡è®¡ç®—ï¼Œå¾—å‡ºæ¥<strong>å‘ç”Ÿå˜æ›´çš„å­—æ®µ</strong>ã€‚è€Œè®¡ç®—çš„æ–¹å¼æ˜¯ <code>ThreeWayMerge</code>ã€‚è¯¥å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateThreeWayMergePatch</span><span class="params">(original, modified, current []<span class="keyword">byte</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">	schema LookupPatchMeta, </span></span></span><br><span class="line"><span class="function"><span class="params">	overwrite <span class="keyword">bool</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">	fns ...mergepatch.PreconditionFunc)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å‰3ä¸ªå…¥å‚å¯¹åº”çš„å«ä¹‰å¦‚ä¸‹ï¼ˆå› ä¸ºåé¢ patch çš„è®¡ç®—ï¼Œéœ€è¦ç”¨åˆ°æ­¤3ä¸ªå…¥å‚ï¼Œææ¸…æ¥šä»–ä»¬çš„å«ä¹‰ç‰¹åˆ«é‡è¦ï¼‰ï¼š</p>
<ul>
<li><p><code>original</code>: å½“å‰é›†ç¾¤ä¸­è¯¥èµ„æºçš„å®šä¹‰ä¸­ Annotations ä¸­ <code>kubectl.kubernetes.io/last-applied-configuration</code> å¯¹åº”çš„å†…å®¹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">original, err := util.GetOriginalConfiguration(obj)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>modified</code>: å‚ç…§ç¬¬â‘¡æ­¥ä¸­çš„è§£é‡Šã€‚</p>
</li>
<li><p><code>current</code>: å½“å‰é›†ç¾¤ä¸­è¯¥èµ„æºçš„å®šä¹‰ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current, err := runtime.Encode(unstructured.UnstructuredJSONScheme, obj)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p> åŸºäºå¯¹ä¸Šé¢ 3 ä¸ªå…¥å‚çš„è®¤çŸ¥ï¼Œå¼€å§‹è¿›å…¥ patch è®¡ç®—çš„è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ <code>ThreeWay</code> åº”è¯¥å°±æ˜¯æŒ‡é€šè¿‡ä¸Šé¢çš„ 3 ä¸ªå…¥å‚ã€‚</p>
</blockquote>
<p>å…ˆå°† <code>original</code>,<code>modified</code>,<code>current</code> ä¸‰ä¸ªå˜é‡è½¬æˆ <code>map[string]interface&#123;&#125;</code>ç±»å‹ä¸º <code>originalMap</code>ã€<code>modifiedMap</code> ã€<code>currentMap</code>ï¼Œä»¥ä¾¿äºåé¢è®¡ç®—ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">originalMap := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(original) &gt; <span class="number">0</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := json.Unmarshal(original, &amp;originalMap); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, mergepatch.ErrBadJSONDoc</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ä¼šè®¡ç®— 3 ç»„æ•°æ®ï¼Œåˆ†åˆ«ä¸º</p>
<ul>
<li><p><code>deltaMap</code>: <code>current</code> ä¸ <code>modified</code> ä¹‹é—´çš„å·®å¼‚ï¼ˆé™¤å» <code>deletion</code> æ“ä½œï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deltaMapDiffOptions := DiffOptions&#123;</span><br><span class="line">  IgnoreDeletions: <span class="literal">true</span>,</span><br><span class="line">  SetElementOrder: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line">deltaMap, err := diffMaps(currentMap, modifiedMap, schema, deltaMapDiffOptions)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>deletionsMap</code>: <code>originalMap</code> ä¸ <code>modifiedMap</code> ä¹‹é—´çš„ <code>deletions</code> æ“ä½œ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deletionsMapDiffOptions := DiffOptions&#123;</span><br><span class="line">  SetElementOrder:           <span class="literal">true</span>,</span><br><span class="line">  IgnoreChangesAndAdditions: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line">deletionsMap, err := diffMaps(originalMap, modifiedMap, schema, deletionsMapDiffOptions)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>patchMap</code>: <code>deltaMap</code> å’Œ <code>deletionsMap</code> æ‰§è¡Œ <code>merge</code> æ“ä½œåå¾—åˆ° <code>patchMap</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mergeOptions := MergeOptions&#123;&#125;</span><br><span class="line">patchMap, err := mergeMap(deletionsMap, deltaMap, schema, mergeOptions)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>æœ€ç»ˆè¿”å› <code>json.Marshal(patchMap)</code>ã€‚è‡³æ­¤è®¡ç®— <code>patch</code> ç»“æŸã€‚</p>
<blockquote>
<p>â“ä¸ºä»€ä¹ˆ patch çš„è®¡ç®—æ–¹æ³•æ˜¯è¿™æ ·çš„å‘¢ï¼Ÿ</p>
</blockquote>
<p><img src="/images/pics/XLW8qA.png" alt="XLW8qA"></p>
<h3 id="â‘¤-å‘é€-PATCH-è¯·æ±‚ç»™-api-server"><a href="#â‘¤-å‘é€-PATCH-è¯·æ±‚ç»™-api-server" class="headerlink" title="â‘¤ å‘é€ PATCH è¯·æ±‚ç»™ api-server"></a>â‘¤ å‘é€ PATCH è¯·æ±‚ç»™ api-server</h3><p>åœ¨ <code> strategicpatch.CreateThreeWayMergePatch()</code> å‡½æ•°æ‰§è¡Œå®Œåï¼Œå¾—åˆ° <code>patch</code> çš„ç»“æœï¼Œç„¶åè°ƒç”¨ client å‘é€ PATCH è¯·æ±‚ç»™åˆ° api-serverï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤ç§æƒ…å½¢å¾—åˆ°çš„ apply ç»“æœæ˜¯ unchangedã€‚</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">string</span>(patch) == <span class="string">&quot;&#123;&#125;&quot;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> patch, obj, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ client å‘é€ PATCH è¯·æ±‚</span></span><br><span class="line">patchedObj, err := p.Helper.Patch(namespace, name, patchType, patch, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> patch, patchedObj, err</span><br></pre></td></tr></table></figure>

<h2 id="Server-Side-Apply"><a href="#Server-Side-Apply" class="headerlink" title="Server Side Apply"></a>Server Side Apply</h2><p>å®˜ç½‘æ–‡æ¡£è¯´æ˜è§<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/using-api/server-side-apply/">é“¾æ¥</a>ã€‚</p>
<p>å¯ç”¨ Server Side Apply éœ€è¦æ·»åŠ  <code>--server-side</code> å‚æ•°ã€ä»¥åŠé€šè¿‡ <code>--field-manager=some-controller</code> æ¥æŒ‡å®š managerï¼ˆå¯é€‰ï¼‰ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply --server-side --field-manager=some-controller -f testdata/apply/cm.yaml</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®Œæˆåï¼Œå¯ä»¥åœ¨è·å–è¯¥ ConfigMap æ—¶ï¼Œæ·»åŠ  <code>--show-managed-fields</code> å‚æ•°ä»¥å±•ç¤º <code>managedFields</code> å­—æ®µã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cm test1 -o json --show-managed-fields</span><br></pre></td></tr></table></figure>

<h3 id="å†²çª"><a href="#å†²çª" class="headerlink" title="å†²çª"></a>å†²çª</h3><p>å½“æœ¬æ¬¡ apply æ“ä½œä¸­æƒ³è¦ä¿®æ”¹çš„å€¼ï¼Œå·²ç»è¢«<strong>å…¶å®ƒ manager</strong> ç®¡ç†åï¼Œå‡ºç°çš„ä¸€ç§çŠ¶æ€ã€‚ä¸»è¦æ˜¯ä¸ºäº†é¿å…å­—æ®µè¢«åˆ«çš„ç”¨æˆ·ä¿®æ”¹ã€‚</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>å…³äº kubectl apply çš„æµç¨‹åˆ†æ</p><p><a href="https://eucham.me/2022/06/09/d092d4969a94.html">https://eucham.me/2022/06/09/d092d4969a94.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>é‡å¯»</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2022-06-09</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2022-06-13</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/kubernetes/">kubernetes</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5f548d5caad6e60013d63db8&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/07/14/7a73b54f4876.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Kubernetes ä¸­ apiserver åŠ è½½ schema æµç¨‹</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/06/01/5c4e354e0c1f.html"><span class="level-item">Goä¸Cã€æ±‡ç¼–ä¹‹é—´çš„è°ƒç”¨</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">è¯„è®º</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://eucham.me/2022/06/09/d092d4969a94.html';
            this.page.identifier = '2022/06/09/d092d4969a94.html';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'eucham' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">åæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">å››æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">åæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">å››æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">åæœˆ 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">å››æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">åæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">å››æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2018</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">å››æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">åæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/249b2dc63505.html"><img src="/images/pics/5300c911560a8d2e0d745dcaf025d22f.jpg" alt="Mç³»åˆ—MacBookè¿æ¥l2tpæ—¶å¤±è´¥çš„é—®é¢˜ä¿®å¤"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/249b2dc63505.html">Mç³»åˆ—MacBookè¿æ¥l2tpæ—¶å¤±è´¥çš„é—®é¢˜ä¿®å¤</a></p><p class="categories"><a href="/categories/macOS/">macOS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/e9036e8500f6.html"><img src="/images/thumbnails/rust-lang.png" alt="Rustå­¦ä¹ ç¬”è®°"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/e9036e8500f6.html">Rustå­¦ä¹ ç¬”è®°</a></p><p class="categories"><a href="/categories/Rust/">Rust</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/4948e86c1262.html"><img src="/images/pics/DrRvr9.jpg" alt="Calicoè¯ä¹¦å­¦ä¹ ç¬”è®°"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/4948e86c1262.html">Calicoè¯ä¹¦å­¦ä¹ ç¬”è®°</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/6dae87e31dc3.html"><img src="/images/pics/e9f22d889a230bfda8e24c0a981740a8.png" alt="å¦‚ä½•åœ¨YAMLæ–‡ä»¶ä¸­è¿›è¡Œä¼˜é›…åœ°æ¢è¡Œ"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/6dae87e31dc3.html">å¦‚ä½•åœ¨YAMLæ–‡ä»¶ä¸­è¿›è¡Œä¼˜é›…åœ°æ¢è¡Œ</a></p><p class="categories"><a href="/categories/Golang/">Golang</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2024/12/09/25470f32f4bb.html"><img src="/images/pics/kubernetes-cka-color.svg" alt="CKSè¯ä¹¦å­¦ä¹ èµ„æ–™æ±‡ç¼–"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-12-08T16:00:00.000Z">2024-12-09</time></p><p class="title"><a href="/2024/12/09/25470f32f4bb.html">CKSè¯ä¹¦å­¦ä¹ èµ„æ–™æ±‡ç¼–</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://crisfang.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Cris</span></span><span class="level-right"><span class="level-item tag">crisfang.com</span></span></a></li><li><a class="level is-mobile" href="https://sanyuesha.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ä¸‰æœˆæ²™</span></span><span class="level-right"><span class="level-item tag">sanyuesha.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/pics/d261cdb6203e0da42ae1324dd3aae11f.png" alt="é‡å¯»ç¬”è®°" height="28"></a><p class="is-size-7"><span>&copy; 2024 é‡å¯»</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="To Find Me" href="https://github.com/eucham"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/eucham"><i class="fab fa-linkedin"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>